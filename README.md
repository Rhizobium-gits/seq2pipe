```
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â•šâ•â•â•â•â–ˆâ–ˆâ•—
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•”â•â•
 â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â–„â–„ â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â–€â–€â•â• â•šâ•â•â•â•â•â•
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â•
 â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â•šâ•â•     â•šâ•â•â•šâ•â•     â•šâ•â•â•â•â•â•â•
      sequence -> pipeline
```

> **ãƒ­ãƒ¼ã‚«ãƒ« LLM ã§ QIIME2 ãƒã‚¤ã‚¯ãƒ­ãƒã‚¤ã‚ªãƒ¼ãƒ è§£æã‚’è‡ªå‹•åŒ– â€” ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ»API ã‚­ãƒ¼ä¸è¦ãƒ»ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹**

---

## æ—¥æœ¬èª | [English](#english)

---

## ã“ã‚Œã¯ä½•ï¼Ÿ

**seq2pipe** ã¯ã€ã‚ãªãŸã® PC ã§å‹•ããƒ­ãƒ¼ã‚«ãƒ« AI ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã™ã€‚
ç”Ÿã® FASTQ ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™ã ã‘ã§ã€QIIME2 è§£æãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®**è¨­è¨ˆãƒ»å®Ÿè¡Œãƒ»Python è§£æãƒ»ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ**ã¾ã§è‡ªå‹•ã§è¡Œã„ã¾ã™ã€‚

- **èµ·å‹•æ™‚ã«æ—¥æœ¬èª / è‹±èªã‚’é¸æŠ**ã—ã€ä»¥é™ã® AI å¿œç­”ãƒ»ãƒ¬ãƒãƒ¼ãƒˆã‚’çµ±ä¸€
- èµ·å‹•æ™‚ã« Python ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆnumpy / pandas ç­‰ï¼‰ã®å­˜åœ¨ã‚’è‡ªå‹•ç¢ºèª
- ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’è‡ªå‹•ã§èª¿æŸ»ï¼ˆFASTQ / ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ / æ—¢å­˜ QZAï¼‰
- ãƒ‡ãƒ¼ã‚¿ã«åˆã£ãŸ QIIME2 ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚¼ãƒ­ã‹ã‚‰çµ„ã¿ç«‹ã¦ã‚‹
- ã™ãå®Ÿè¡Œã§ãã‚‹ `.sh` / `.ps1` ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›¸ãå‡ºã™
- **2 ã¤ã®æ“ä½œãƒ¢ãƒ¼ãƒ‰**: ãƒ¢ãƒ¼ãƒ‰ 1ï¼ˆè‡ªç„¶è¨€èªã§ã‚„ã‚ŠãŸã„è§£æã‚’æŒ‡å®šï¼‰ãƒ»ãƒ¢ãƒ¼ãƒ‰ 2ï¼ˆAI ãŒè‡ªå¾‹çš„ã«å…¨è§£æã‚’è¨­è¨ˆãƒ»å®Ÿè¡Œãƒ»`--auto` ãƒ•ãƒ©ã‚°ï¼‰
- **ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—å‹ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆvibe-local æ–¹å¼ï¼‰**: LLM ãŒã¾ãš `read_file` ã§ãƒ‡ãƒ¼ã‚¿ã®åˆ—åãƒ»å½¢å¼ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ç²¾åº¦ãŒé«˜ãã€ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã‚‚ `NEVER GIVE UP` ã§è‡ªå‹•ä¿®æ­£ã‚’ç¹°ã‚Šè¿”ã™
- QIIME2 ã®å‡ºåŠ›ã‚’ **Pythonï¼ˆpandas / scipy / scikit-learn / matplotlibï¼‰ã§é«˜åº¦è§£æ**
- è§£æå›³ã‚’ã™ã¹ã¦ **PDF ã¨ã—ã¦è‡ªå‹•ä¿å­˜**ï¼ˆview.qiime2.org ä¸è¦ï¼‰
- **AI è‡ªå¾‹è§£æï¼ˆãƒ¢ãƒ¼ãƒ‰ 2ï¼‰**: 5 ãƒ•ã‚§ãƒ¼ã‚ºãƒ»14 ç¨®é¡ã®å›³ã‚’å…¨è‡ªå‹•ã§ç”Ÿæˆï¼ˆPCA / PCoA / NMDS / ãƒ¬ã‚¢ãƒ•ã‚¡ã‚¯ã‚·ãƒ§ãƒ³æ›²ç·š / åˆ†é¡çµ„æˆ heatmap / ã‚µãƒ³ãƒ—ãƒ«ç›¸é–¢è¡Œåˆ— ãªã©ï¼‰
- è§£æçµ‚äº†å¾Œã« **æ—¥æœ¬èªãƒ»è‹±èªã® TeX / PDF ãƒ¬ãƒãƒ¼ãƒˆã‚’è‡ªå‹•ç”Ÿæˆ**ï¼ˆ`build_report_tex` ãŒ ANALYSIS_LOG ã‹ã‚‰è‡ªå‹•æ§‹ç¯‰ï¼‰

ã™ã¹ã¦ **ã‚ãªãŸã®ãƒã‚·ãƒ³ä¸Š** ã§å®Œçµã€‚ã‚¯ãƒ©ã‚¦ãƒ‰ã‚„æœ‰æ–™ API ã¯ä¸€åˆ‡ä½¿ã„ã¾ã›ã‚“ã€‚

---

## å¿…è¦ãªã‚‚ã®

| | macOS | Linux | Windows |
|---|---|---|---|
| Python | 3.9 ä»¥ä¸Š | 3.9 ä»¥ä¸Š | 3.9 ä»¥ä¸Š |
| Ollama | `setup.sh` ã§è‡ªå‹• | `setup.sh` ã§è‡ªå‹• | `setup.bat` ã§è‡ªå‹• |
| QIIME2 | conda ç’°å¢ƒï¼ˆæ¨å¥¨ï¼‰ã¾ãŸã¯ Docker | conda ç’°å¢ƒã¾ãŸã¯ Docker Engine | Docker Desktop |
| Docker | ä»»æ„ï¼ˆQIIME2 conda env ãŒã‚ã‚Œã°ä¸è¦ï¼‰ | ä»»æ„ | Docker Desktop |
| Python è§£æãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | QIIME2 conda env ã«å«ã¾ã‚Œã‚‹ | QIIME2 conda env ã«å«ã¾ã‚Œã‚‹ | æ‰‹å‹• pip |
| RAM | 8 GB ä»¥ä¸Šæ¨å¥¨ | 8 GB ä»¥ä¸Šæ¨å¥¨ | 8 GB ä»¥ä¸Šæ¨å¥¨ |
| ãƒ‡ã‚£ã‚¹ã‚¯ | ç´„ 10 GBï¼ˆLLM + QIIME2ï¼‰ | ç´„ 10 GB | ç´„ 10 GB |

**Python è§£æãƒ‘ãƒƒã‚±ãƒ¼ã‚¸**ï¼ˆ`setup.sh` ãŒè‡ªå‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼‰:
`numpy`, `pandas`, `matplotlib`, `seaborn`, `scipy`, `scikit-learn`, `biom-format`, `networkx`, `statsmodels`

---

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆ3 ã‚¹ãƒ†ãƒƒãƒ—ï¼‰

### macOS

```bash
git clone https://github.com/Rhizobium-gits/seq2pipe.git
cd seq2pipe
chmod +x setup.sh launch.sh
./setup.sh      # åˆå›ã®ã¿ï¼ˆOllama + Python ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ + Docker ç¢ºèªï¼‰
./launch.sh     # èµ·å‹•
```

### Linuxï¼ˆUbuntu / Debian / Fedora / Arch ãªã©ï¼‰

```bash
git clone https://github.com/Rhizobium-gits/seq2pipe.git
cd seq2pipe
chmod +x setup.sh launch.sh
./setup.sh      # åˆå›ã®ã¿ï¼ˆDocker Engine ã‚’è‡ªå‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼‰
./launch.sh     # èµ·å‹•
```

> Linux ã®å ´åˆã€`setup.sh` å®Œäº†å¾Œã« `newgrp docker` ã¾ãŸã¯å†ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ãªå ´åˆãŒã‚ã‚Šã¾ã™ã€‚

### Windows

```
1. git clone https://github.com/Rhizobium-gits/seq2pipe.git
2. seq2pipe ãƒ•ã‚©ãƒ«ãƒ€ã‚’é–‹ã
3. setup.bat ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ï¼ˆåˆå›ã®ã¿ï¼‰
4. launch.bat ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã—ã¦èµ·å‹•
```

PowerShell ã‚’ä½¿ã†å ´åˆ:

```powershell
Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy RemoteSigned
.\setup.ps1   # åˆå›ã®ã¿
.\launch.ps1  # èµ·å‹•
```

Windows ã® Python è§£æãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯æ‰‹å‹•ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„:

```powershell
pip install numpy pandas matplotlib seaborn scipy scikit-learn biom-format networkx statsmodels
```

---

## ä½¿ã„æ–¹

### QIIME2 ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ç”Ÿæˆ

èµ·å‹•ã™ã‚‹ã¨ã€ã¾ãšè¨€èªã‚’é¸æŠã—ã¦ã‹ã‚‰ AI ãŒãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚

```
è¨€èªã‚’é¸æŠã—ã¦ãã ã•ã„ / Select language:
  1. æ—¥æœ¬èª (ja)
  2. English (en)
> 1

AI: ã“ã‚“ã«ã¡ã¯ï¼ä»¥ä¸‹ã‚’æ•™ãˆã¦ãã ã•ã„:
    1. ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ‘ã‚¹
    2. å®Ÿé¨“ç³»ã®èª¬æ˜ï¼ˆé ˜åŸŸãƒ»ãƒ—ãƒ©ã‚¤ãƒãƒ¼ãƒ»æ¯”è¼ƒã‚°ãƒ«ãƒ¼ãƒ—ï¼‰
    3. è¡Œã„ãŸã„è§£æ
    4. å›³ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆçœç•¥å¯ï¼‰

ã‚ãªãŸ > ãƒ‡ãƒ¼ã‚¿: /Users/yourname/microbiome-data/
         å®Ÿé¨“ç³»: ãƒ’ãƒˆè…¸å†…ç´°èŒã€16S V3-V4ï¼ˆ341F/806Rï¼‰ã€MiSeq PE 2Ã—250bp
                 ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« 5 ã‚µãƒ³ãƒ—ãƒ« vs å‡¦ç†ç¾¤ 5 ã‚µãƒ³ãƒ—ãƒ«
         è§£æ: åˆ†é¡çµ„æˆ + Î±/Î² å¤šæ§˜æ€§ + å·®æ¬¡è§£æ
         ã‚¹ã‚¿ã‚¤ãƒ«: ç™½èƒŒæ™¯ãƒ»é’ç³»ã‚«ãƒ©ãƒ¼

[ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œ: inspect_directory]
  -> ãƒšã‚¢ã‚¨ãƒ³ãƒ‰ FASTQ 10 ã‚µãƒ³ãƒ—ãƒ«ã‚’æ¤œå‡ºã€metadata.tsv ã‚‚ç¢ºèª...

[ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œ: set_plot_config]
  -> style: seaborn-v0_8-whitegrid, palette: Blues ã«è¨­å®š

AI: V3-V4 ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¾ã™ã€‚
    trim-left-f=17, trunc-f=270 ã‚’é©ç”¨ã€‚
    -> manifest.tsv, run_pipeline.sh, setup_classifier.sh, ANALYSIS_README.md
```

### è‡ªå¾‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ¢ãƒ¼ãƒ‰ 2 / --autoï¼‰

QIIME2 è§£æå¾Œã€AI ãŒè‡ªå¾‹çš„ã« 5 ãƒ•ã‚§ãƒ¼ã‚ºãƒ»14 ç¨®é¡ã®å›³ã‚’å…¨è‡ªå‹•ã§ç”Ÿæˆã—ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æŒ‡ç¤ºã¯ä¸è¦ã§ã™ã€‚
**vibe-local æ–¹å¼**: LLM ãŒã¾ãšãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `read_file` ã§èª­ã‚“ã§åˆ—åãƒ»å½¢å¼ã‚’æŠŠæ¡ã—ã¦ã‹ã‚‰ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ããŸã‚ã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒŸã‚¹ã«ã‚ˆã‚‹ã‚¨ãƒ©ãƒ¼ãŒæ¥µã‚ã¦å°‘ãªã„ã€‚
ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã‚‚ `write_file` ã§ä¿®æ­£ â†’ `run_python` ã§å†å®Ÿè¡Œã‚’ EXIT CODE: 0 ã«ãªã‚‹ã¾ã§ç¹°ã‚Šè¿”ã—ã¾ã™ã€‚

```
$ ~/miniforge3/envs/qiime2/bin/python ~/seq2pipe/cli.py --auto --manifest manifest.tsv

  [è™¹è‰²ãƒãƒŠãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³]

  ãƒ¢ãƒ¼ãƒ‰: è‡ªå¾‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆæœ€å¤§ 40 ã‚¹ãƒ†ãƒƒãƒ—ï¼‰

  ğŸš€ STEP 1/2: QIIME2 ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œä¸­
    -> dada2 denoise-paired, classify-sklearn, core-metrics-phylogenetic...
  âœ… ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Œäº† â†’ ~/seq2pipe_results/20260225_120000/

  ğŸ¤– STEP 2/2: è‡ªå¾‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆtool-calling ãƒ«ãƒ¼ãƒ—ï¼‰

  [list_files] ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸€è¦§
    -> feature_table: 1 ä»¶ / taxonomy: 1 ä»¶ / alpha: 4 ä»¶ / beta: 4 ä»¶

  [Phase 0: ã‚¯ã‚ªãƒªãƒ†ã‚£ç¢ºèª]
  [read_file] denoising/stats.tsv ã‚’èª­ã‚€ï¼ˆåˆ—åç¢ºèªï¼‰
  [write_file] quality_plot.py ã‚’ç”Ÿæˆ
  [run_python] EXIT CODE: 0 â†’ denoising_stats.pdf ä¿å­˜

  [Phase 1: Î±å¤šæ§˜æ€§]
  [read_file] alpha/shannon_vector.tsv ã‚’èª­ã‚€ï¼ˆåˆ—åç¢ºèªï¼‰
  [write_file] alpha_diversity.py ã‚’ç”Ÿæˆ
  [run_python] EXIT CODE: 0 â†’ alpha_diversity.pdfï¼ˆShannon/Chao1/Simpson/Faith's PDï¼‰

  [Phase 2: Î²å¤šæ§˜æ€§]
  [read_file] beta/bray_curtis_pcoa_results.tsv ã‚’èª­ã‚€
  [write_file] beta_diversity.py ã‚’ç”Ÿæˆï¼ˆPCoA + CLR-PCA + NMDS + ãƒ¬ã‚¢ãƒ•ã‚¡ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
  [run_python] EXIT CODE: 0 â†’ beta_pcoa.pdf / beta_clr_pca.pdf / beta_nmds.pdf / rarefaction.pdf

  [Phase 3: åˆ†é¡çµ„æˆ]
  [read_file] taxonomy/taxonomy.tsv + feature-table.tsv ã‚’èª­ã‚€
  [write_file] taxonomy_plot.py ã‚’ç”Ÿæˆï¼ˆphylum stacked bar + genus heatmap + CLR barï¼‰
  [run_python] EXIT CODE: 0 â†’ taxonomy_barplot.pdf / taxonomy_heatmap.pdf / taxonomy_clr.pdf

  [Phase 4: ã‚µãƒ³ãƒ—ãƒ«ç›¸é–¢]
  [write_file] correlation_plot.py ã‚’ç”Ÿæˆ
  [run_python] EXIT CODE: 0 â†’ sample_correlation.pdf

  âœ… è‡ªå¾‹è§£æå®Œäº†ï¼ï¼ˆ5 ãƒ•ã‚§ãƒ¼ã‚º / 14 ä»¶ã®å›³ï¼‰
```

### è§£æãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ¢ãƒ¼ãƒ‰ 1ï¼‰- è‡ªç„¶è¨€èªã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

QIIME2 ã®çµæœã‚’å—ã‘å–ã£ãŸã‚‰ã€ã‚„ã‚ŠãŸã„è§£æã‚’è‡ªç„¶è¨€èªã§æŒ‡å®šã§ãã¾ã™ã€‚
LLM ãŒãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ˆã«èª­ã‚“ã§ã‹ã‚‰æ­£ç¢ºãªã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã€ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã¨è‡ªå‹•ä¿®æ­£ã—ã¾ã™ã€‚

```
$ ~/miniforge3/envs/qiime2/bin/python ~/seq2pipe/cli.py --export-dir ~/seq2pipe_results/20260225_120000/exported/

ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠã—ã¦ãã ã•ã„:
  1. è§£æãƒ¢ãƒ¼ãƒ‰        ã‚„ã‚ŠãŸã„è§£æã‚’è‡ªç„¶è¨€èªã§æŒ‡å®š
  2. è‡ªå¾‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ  AI ãŒè‡ªåˆ†ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª¿ã¹ã¦å…¨è§£æã‚’å…¨è‡ªå‹•å®Ÿè¡Œ

é¸æŠ (1/2) [1]: 1
ã‚„ã‚ŠãŸã„è§£æã‚’å…¥åŠ›ã—ã¦ãã ã•ã„: Shannon å¤šæ§˜æ€§ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã« violin plot ã§æ¯”è¼ƒã—ã¦ã€Mann-Whitney U æ¤œå®šã® p å€¤ã‚‚è¡¨ç¤º

[list_files] ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸€è¦§
[read_file]  alpha/shannon_vector.tsv ã®å…ˆé ­ã‚’ç¢ºèªï¼ˆåˆ—å: sample-id, shannon_entropyï¼‰
[write_file] analysis.py ã‚’ç”Ÿæˆï¼ˆviolin plot + çµ±è¨ˆæ¤œå®šï¼‰
[run_python] EXIT CODE: 0
  -> ~/seq2pipe_results/20260225_120000/figures/shannon_violin.pdf ä¿å­˜

âœ… è§£æå®Œäº†ï¼
ğŸ“Š ç”Ÿæˆã•ã‚ŒãŸå›³ (1 ä»¶):
   /Users/yourname/seq2pipe_results/20260225_120000/figures/shannon_violin.pdf
```

### å›³ã®ã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ›´

ã„ã¤ã§ã‚‚å¤‰æ›´ã§ãã¾ã™ã€‚ä»¥é™ã®å›³ã™ã¹ã¦ã«å³æ™‚åæ˜ ã•ã‚Œã¾ã™ã€‚

```
ã‚ãªãŸ > å›³ã‚’è«–æ–‡å‘ã‘ã« 300 DPI ã® PNG ã«å¤‰ãˆã¦

[ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œ: set_plot_config]
  -> dpi: 300, format: png ã«å¤‰æ›´
```

### ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«

```
<ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª>/
â”œâ”€â”€ manifest.tsv              # QIIME2 ã‚¤ãƒ³ãƒãƒ¼ãƒˆç”¨ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ
â”œâ”€â”€ setup_classifier.sh       # SILVA 138 åˆ†é¡å™¨ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
â”œâ”€â”€ run_pipeline.sh           # è§£æãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å…¨ä½“
â”œâ”€â”€ results/
â”‚   â”œâ”€â”€ table.qza             <- OTU/ASV ãƒ†ãƒ¼ãƒ–ãƒ«
â”‚   â”œâ”€â”€ taxonomy.qza          <- åˆ†é¡çµæœ
â”‚   â”œâ”€â”€ core-metrics-results/ <- å¤šæ§˜æ€§è§£æ
â”‚   â””â”€â”€ ancombc-results.qza   <- å·®æ¬¡è§£æï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
â””â”€â”€ ANALYSIS_README.md        <- ã“ã®ãƒ‡ãƒ¼ã‚¿å°‚ç”¨ã®æ“ä½œã‚¬ã‚¤ãƒ‰

~/seq2pipe_results/<ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—>/        <- ã‚»ãƒƒã‚·ãƒ§ãƒ³ã”ã¨ã«è‡ªå‹•ä½œæˆ
â”œâ”€â”€ figures/
â”‚   â”œâ”€â”€ alpha_diversity/      <- Phase 1: Î±å¤šæ§˜æ€§ï¼ˆShannon, Simpson, Chao1ï¼‰
â”‚   â”‚   â”œâ”€â”€ alpha_boxplot.pdf
â”‚   â”‚   â””â”€â”€ alpha_stats.pdf
â”‚   â”œâ”€â”€ beta_diversity/       <- Phase 2: Î²å¤šæ§˜æ€§ï¼ˆPCoA, PERMANOVAï¼‰
â”‚   â”‚   â””â”€â”€ pcoa_bray_curtis.pdf
â”‚   â”œâ”€â”€ taxonomy/             <- Phase 3: åˆ†é¡çµ„æˆï¼ˆbar chart, heatmapï¼‰
â”‚   â”‚   â”œâ”€â”€ taxonomy_barplot.pdf
â”‚   â”‚   â””â”€â”€ taxonomy_heatmap.pdf
â”‚   â”œâ”€â”€ differential_abundance/ <- Phase 4: å·®æ¬¡è§£æï¼ˆvolcano plotï¼‰
â”‚   â”‚   â””â”€â”€ volcano_plot.pdf
â”‚   â”œâ”€â”€ machine_learning/     <- Phase 5: æ©Ÿæ¢°å­¦ç¿’ï¼ˆRF, AUC, feature importanceï¼‰
â”‚   â”‚   â””â”€â”€ feature_importance.pdf
â”‚   â””â”€â”€ <ãã®ä»–æ‰‹å‹•è§£æã®å›³>
â””â”€â”€ report/
    â”œâ”€â”€ report_ja.tex / report_ja.pdf   <- æ—¥æœ¬èªãƒ¬ãƒãƒ¼ãƒˆï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
    â””â”€â”€ report_en.tex / report_en.pdf   <- è‹±èªãƒ¬ãƒãƒ¼ãƒˆï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
```

### è§£æçµæœã®ç¢ºèª

| å‡ºåŠ› | ç¢ºèªæ–¹æ³• |
|---|---|
| Python ç”Ÿæˆã®å›³ï¼ˆ.pdf / .pngï¼‰ | ãã®ã¾ã¾é–‹ã‘ã‚‹ï¼ˆPDF viewer / ç”»åƒãƒ“ãƒ¥ãƒ¼ã‚¢ï¼‰ |
| QIIME2 ã® `.qzv`ï¼ˆã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–å¯è¦–åŒ–ï¼‰ | [https://view.qiime2.org](https://view.qiime2.org) ã«ãƒ‰ãƒ­ãƒƒãƒ— |
| ãƒ¬ãƒãƒ¼ãƒˆ PDF | PDF viewer ã§é–‹ã |

---

## å¯¾å¿œè§£æä¸€è¦§

### QIIME2 ã‚³ã‚¢è§£æ
| è§£æ | ã‚³ãƒãƒ³ãƒ‰ |
|---|---|
| ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ»ãƒ‡ãƒãƒ«ãƒãƒ—ãƒ¬ãƒƒã‚¯ã‚¹ | `qiime tools import` |
| DADA2 ãƒ‡ãƒã‚¤ã‚¸ãƒ³ã‚° | `qiime dada2 denoise-paired/single` |
| åˆ†é¡ï¼ˆSILVA 138ï¼‰ | `qiime feature-classifier classify-sklearn` |
| åˆ†é¡çµ„æˆãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆ | `qiime taxa barplot` |
| Î±ãƒ»Î² å¤šæ§˜æ€§ | `qiime diversity core-metrics-phylogenetic` |
| å·®æ¬¡è§£æ ANCOM-BC | `qiime composition ancombc` |

### Python ãƒ€ã‚¦ãƒ³ã‚¹ãƒˆãƒªãƒ¼ãƒ è§£æï¼ˆcode_agent.py â€” ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—å‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼‰
| ãƒ•ã‚§ãƒ¼ã‚º | è§£ææ‰‹æ³• | ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ |
|---|---|---|
| Phase 0 (quality) | ãƒ‡ãƒã‚¤ã‚¸ãƒ³ã‚°çµ±è¨ˆï¼ˆå…¥åŠ› / ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° / ãƒ‡ãƒã‚¤ã‚¸ãƒ³ã‚° / éã‚­ãƒ¡ãƒ©ï¼‰ | pandas, matplotlib |
| Phase 1 (alpha) | Shannon / Chao1 / Simpson / Faith's PD + Mann-Whitney U + Kruskal-Wallis | pandas, scipy, seaborn |
| Phase 2 (beta) | Bray-Curtis PCoAãƒ»UniFrac PCoA + CLR å¤‰æ› PCA + NMDS + ãƒ¬ã‚¢ãƒ•ã‚¡ã‚¯ã‚·ãƒ§ãƒ³æ›²ç·š | pandas, sklearn, scipy |
| Phase 3 (taxonomy) | é–€ãƒ¬ãƒ™ãƒ« stacked bar + å±ãƒ¬ãƒ™ãƒ« heatmap + CLR å¤‰æ› phylum bar | pandas, seaborn |
| Phase 4 (correlation) | ã‚µãƒ³ãƒ—ãƒ«é–“ç›¸é–¢è¡Œåˆ— + éšå±¤ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚° heatmap | pandas, seaborn, scipy |
| ãƒ¢ãƒ¼ãƒ‰ 1 | ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡ç¤ºã®ä»»æ„è§£æï¼ˆè‡ªç„¶è¨€èª â†’ read_file ã§å½¢å¼æŠŠæ¡ â†’ ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ â†’ è‡ªå‹•ä¿®æ­£ï¼‰ | å‹•çš„ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯¾å¿œ |
| ãƒ¬ãƒãƒ¼ãƒˆ | ANALYSIS_LOG â†’ TeX â†’ PDF è‡ªå‹•æ§‹ç¯‰ï¼ˆLLM ä¸ä½¿ç”¨ã€é«˜é€Ÿï¼‰ | tectonicï¼ˆTeX â†’ PDFï¼‰ |

---

## ç’°å¢ƒå¤‰æ•°

| å¤‰æ•° | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|---|---|---|
| `QIIME2_AI_MODEL` | `qwen2.5-coder:7b` | ä½¿ç”¨ã™ã‚‹ Ollama ãƒ¢ãƒ‡ãƒ« |
| `SEQ2PIPE_AUTO_YES` | `0` | `1` ã«ã™ã‚‹ã¨ã‚³ãƒãƒ³ãƒ‰ç¢ºèªã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆè‡ªå¾‹ãƒ¢ãƒ¼ãƒ‰ï¼‰ |
| `SEQ2PIPE_MAX_STEPS` | `100` | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ«ãƒ¼ãƒ—ã®æœ€å¤§ã‚¹ãƒ†ãƒƒãƒ—æ•° |
| `SEQ2PIPE_PYTHON_TIMEOUT` | `600` | `execute_python` ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆç§’æ•° |
| `QIIME2_CONDA_BIN` | è‡ªå‹•æ¤œå‡º | QIIME2 conda ç’°å¢ƒã® bin ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆæ‰‹å‹•æŒ‡å®šç”¨ï¼‰ |

```bash
# ä¾‹: è‡ªå¾‹ãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•ï¼ˆç¢ºèªãªã—ï¼‰
SEQ2PIPE_AUTO_YES=1 ./launch.sh

# ä¾‹: QIIME2 conda env ã‚’æ‰‹å‹•æŒ‡å®š
QIIME2_CONDA_BIN=/opt/conda/envs/qiime2/bin ./launch.sh
```

---

## ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«

| ãƒ¢ãƒ‡ãƒ« | RAM | ç‰¹å¾´ |
|---|---|---|
| `qwen2.5-coder:7b` | 8 GB ä»¥ä¸Š | ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã«æœ€é©ï¼ˆæ¨å¥¨ï¼‰ |
| `qwen2.5-coder:3b` | 4 GB ä»¥ä¸Š | è»½é‡ãƒ»é«˜é€Ÿ |
| `llama3.2:3b` | 4 GB ä»¥ä¸Š | æ±ç”¨ãƒ»ä¼šè©±èƒ½åŠ›é«˜ã‚ |
| `qwen3:8b` | 16 GB ä»¥ä¸Š | æœ€é«˜å“è³ªãƒ»æ¨è«–èƒ½åŠ›ã‚‚é«˜ã„ |

åˆ¥ã®ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ã†ã«ã¯:

```bash
# macOS / Linux
QIIME2_AI_MODEL=qwen2.5-coder:3b ./launch.sh

# Windowsï¼ˆPowerShellï¼‰
$env:QIIME2_AI_MODEL = "qwen2.5-coder:3b"; .\launch.ps1
```

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
ã‚ãªãŸ
  |
  v
[ launch.sh / launch.bat ]  â†’  [ cli.py ]  â† ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼ˆè™¹è‰²ãƒãƒŠãƒ¼ãƒ»ãƒ¢ãƒ¼ãƒ‰é¸æŠï¼‰
                                    |
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          |                         |                          |
          v                         v                          v
  ãƒ¢ãƒ¼ãƒ‰ 1: è§£æãƒ¢ãƒ¼ãƒ‰      [ pipeline_runner.py ]     ãƒ¢ãƒ¼ãƒ‰ 2: è‡ªå¾‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
  ï¼ˆè‡ªç„¶è¨€èªã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰   QIIME2 ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œ      ï¼ˆ--auto ãƒ•ãƒ©ã‚°ï¼‰
                             + çµæœã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
          |                         |                          |
          v                         v                          v
  [ code_agent.py ]  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  [ code_agent.py ]
    ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—å‹ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
    |
    +---> Ollama (localhost:11434)  <-- ãƒ­ãƒ¼ã‚«ãƒ« LLM
    |       TOOL FIRST: å…ˆã«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã‚“ã§ã‹ã‚‰ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
    |       NEVER GIVE UP: ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã‚‰ write_file ã§ä¿®æ­£ â†’ run_python ã§å†å®Ÿè¡Œ
    |
    +-- list_files      (ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§)
    +-- read_file       (ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ã‚’ LLM ã«æ¸¡ã™ â†’ åˆ—åãƒ»å½¢å¼ã‚’æŠŠæ¡ã—ã¦ã‹ã‚‰æ›¸ã)
    +-- write_file      (atomic write: mkstemp+replace ã§å®‰å…¨ãª Python ã‚¹ã‚¯ãƒªãƒ—ãƒˆç”Ÿæˆ)
    +-- run_python      (QIIME2 conda Python ã§å®Ÿè¡Œ â†’ exit code ç¢ºèª)
    `-- install_package (ModuleNotFoundError æ¤œå‡º â†’ pip install + ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èªç¢ºèª)

  è‡ªå‹•è§£æã‚¿ã‚¹ã‚¯ï¼ˆãƒ¢ãƒ¼ãƒ‰ 2ï¼‰: 5 ãƒ•ã‚§ãƒ¼ã‚ºãƒ»14 ç¨®é¡ã®å›³
    Phase 0: ã‚¯ã‚ªãƒªãƒ†ã‚£ç¢ºèªï¼ˆãƒ‡ãƒã‚¤ã‚¸ãƒ³ã‚°çµ±è¨ˆï¼‰
    Phase 1: Î±å¤šæ§˜æ€§ï¼ˆShannon / Chao1 / Simpson / Faith's PD + çµ±è¨ˆæ¤œå®šï¼‰
    Phase 2: Î²å¤šæ§˜æ€§ï¼ˆBray-Curtis PCoA / UniFrac PCoA / CLR-PCA / NMDS / ãƒ¬ã‚¢ãƒ•ã‚¡ã‚¯ã‚·ãƒ§ãƒ³æ›²ç·šï¼‰
    Phase 3: åˆ†é¡çµ„æˆï¼ˆphylum stacked bar / genus heatmap / CLR phylum barï¼‰
    Phase 4: ã‚µãƒ³ãƒ—ãƒ«ç›¸é–¢ï¼ˆç›¸é–¢è¡Œåˆ— + éšå±¤ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ï¼‰

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  [ qiime2_agent.py ]  QIIME2 ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ç”Ÿæˆï¼ˆpipeline_runner.py å†…éƒ¨ã§ä½¿ç”¨ï¼‰
    |
    +---> Ollama (localhost:11434)  <-- ãƒ­ãƒ¼ã‚«ãƒ« LLM
    +---> 11 ãƒ„ãƒ¼ãƒ«
            +-- inspect_directory  (ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®èª¿æŸ»)
            +-- read_file          (ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ã®ç¢ºèª)
            +-- write_file         (ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ›¸ãå‡ºã—)
            +-- edit_file          (éƒ¨åˆ†ä¿®æ­£)
            +-- generate_manifest  (QIIME2 ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆç”Ÿæˆ)
            +-- run_command        (QIIME2 å®Ÿè¡Œ: conda env è‡ªå‹•æ¤œå‡º / Docker fallback)
            +-- check_system       (ç’°å¢ƒç¢ºèª)
            +-- set_plot_config    (å›³ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š)
            +-- execute_python     (Python è§£æå®Ÿè¡Œ)
            +-- build_report_tex   (ANALYSIS_LOG â†’ TeX/PDF è‡ªå‹•ç”Ÿæˆ)
            `-- log_analysis_step  (QIIME2 ã‚¹ãƒ†ãƒƒãƒ—ã‚’ ANALYSIS_LOG ã«è¨˜éŒ²)
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

<details>
<summary>Ollama ã«æ¥ç¶šã§ããªã„</summary>

```bash
# macOS / Linux
ollama serve

# Windowsï¼ˆPowerShellï¼‰
Start-Process ollama -ArgumentList "serve"
```

</details>

<details>
<summary>QIIME2 conda ç’°å¢ƒãŒè‡ªå‹•æ¤œå‡ºã•ã‚Œãªã„</summary>

`QIIME2_CONDA_BIN` ã§æ˜ç¤ºçš„ã«æŒ‡å®šã—ã¦ãã ã•ã„:

```bash
QIIME2_CONDA_BIN=/opt/conda/envs/qiime2/bin ./launch.sh
```

è‡ªå‹•æ¤œå‡ºã•ã‚Œã‚‹å€™è£œ: `~/miniforge3/envs/qiime2/bin`, `~/miniconda3/envs/qiime2/bin`, `~/anaconda3/envs/qiime2/bin`

</details>

<details>
<summary>Docker ãŒè¦‹ã¤ã‹ã‚‰ãªã„ / èµ·å‹•ã—ã¦ã„ãªã„</summary>

QIIME2 conda ç’°å¢ƒãŒæ¤œå‡ºã•ã‚Œã¦ã„ã‚‹å ´åˆã€Docker ã¯ä¸è¦ã§ã™ã€‚
conda ç’°å¢ƒãŒãªã„å ´åˆã®ã¿ Docker ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

- macOS / Windows: Docker Desktop ã‚’èµ·å‹•ã—ã¦ãã ã•ã„
- Linux: `sudo systemctl start docker`

</details>

<details>
<summary>Linux: docker ã‚³ãƒãƒ³ãƒ‰ãŒ permission denied</summary>

```bash
sudo usermod -aG docker $USER
newgrp docker
```

</details>

<details>
<summary>Python è§£æãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒè¶³ã‚Šãªã„</summary>

```bash
pip install numpy pandas matplotlib seaborn scipy scikit-learn biom-format networkx statsmodels
```

</details>

<details>
<summary>tectonicï¼ˆPDF ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ï¼‰ãŒè¦‹ã¤ã‹ã‚‰ãªã„</summary>

```bash
# macOS
brew install tectonic

# Linux
curl --proto '=https' --tlsv1.2 -fsSL https://drop.rs/tectonic | sh
```

</details>

<details>
<summary>ãƒ¢ãƒ‡ãƒ«ãŒé‡ã„ / å¿œç­”ãŒé…ã„</summary>

RAM ãŒå°‘ãªã„å ´åˆã¯è»½é‡ãƒ¢ãƒ‡ãƒ«ã«åˆ‡ã‚Šæ›¿ãˆã¦ãã ã•ã„:

```bash
QIIME2_AI_MODEL=qwen2.5-coder:3b ./launch.sh
```

</details>

<details>
<summary>classify-sklearn ã§ãƒ¡ãƒ¢ãƒªã‚¨ãƒ©ãƒ¼</summary>

Docker Desktop ã®è¨­å®šã§ãƒ¡ãƒ¢ãƒªã‚’ 8 GB ä»¥ä¸Šã«å¢—ã‚„ã—ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«æ¬¡ã®ã‚ˆã†ã«ä¼ãˆã¦ãã ã•ã„:

```
ã€Œãƒ¡ãƒ¢ãƒªã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã€‚--p-n-jobs 1 ã§ä¿®æ­£ã—ã¦ã€
```

</details>

<details>
<summary>Windows: å®Ÿè¡Œãƒãƒªã‚·ãƒ¼ã‚¨ãƒ©ãƒ¼</summary>

```powershell
Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy RemoteSigned
```

</details>

---

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
seq2pipe/
â”œâ”€â”€ cli.py            # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼ˆè™¹è‰²ãƒãƒŠãƒ¼ãƒ»ãƒ¢ãƒ¼ãƒ‰é¸æŠãƒ»CLI å¼•æ•°ï¼‰
â”œâ”€â”€ qiime2_agent.py   # QIIME2 ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ç”Ÿæˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆ11 ãƒ„ãƒ¼ãƒ«ï¼‰
â”œâ”€â”€ pipeline_runner.py # QIIME2 å®Ÿè¡Œãƒ©ãƒƒãƒ‘ãƒ¼ + çµæœã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
â”œâ”€â”€ code_agent.py     # ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—å‹ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆ5 ãƒ„ãƒ¼ãƒ«ã€vibe-local æ–¹å¼ï¼‰
â”œâ”€â”€ launch.sh         # macOS / Linux èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ launch.ps1        # Windows èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆPowerShellï¼‰
â”œâ”€â”€ launch.bat        # Windows èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ç”¨ï¼‰
â”œâ”€â”€ setup.sh          # macOS / Linux ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
â”œâ”€â”€ setup.ps1         # Windows ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆPowerShellï¼‰
â”œâ”€â”€ setup.bat         # Windows ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ç”¨ï¼‰
â”œâ”€â”€ LICENSE           # MIT License
â””â”€â”€ README.md         # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

---

## Contributors

| | Name | Role |
|---|---|---|
| [@Rhizobium-gits](https://github.com/Rhizobium-gits) | Rhizobium-gits | Author |
| [@claude-bot](https://github.com/claude-bot) | Claude (Anthropic) | Co-author â€” design & implementation |

---

## å‚è€ƒãƒªãƒ³ã‚¯

- [QIIME2 å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.qiime2.org/)
- [QIIME2 Viewï¼ˆã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–å¯è¦–åŒ–ï¼‰](https://view.qiime2.org)
- [QIIME2 Forum](https://forum.qiime2.org/)
- [SILVA ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹](https://www.arb-silva.de/)
- [Ollama å…¬å¼ã‚µã‚¤ãƒˆ](https://ollama.com/)

---

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

- ã“ã®ãƒ„ãƒ¼ãƒ«: MIT License
- SILVA 138 ãƒ‡ãƒ¼ã‚¿: [CC BY 4.0](https://creativecommons.org/licenses/by/4.0/)
- QIIME2: BSD License

---
---

<a name="english"></a>

# English

```
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â•šâ•â•â•â•â–ˆâ–ˆâ•—
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•”â•â•
 â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â–„â–„ â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â–€â–€â•â• â•šâ•â•â•â•â•â•
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â•
 â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â•šâ•â•     â•šâ•â•â•šâ•â•     â•šâ•â•â•â•â•â•â•
      sequence -> pipeline
```

> **Automate QIIME2 microbiome analysis with a local LLM â€” offline, no API key, open source**

[æ—¥æœ¬èª](#æ—¥æœ¬èª--english)

---

## What is this?

**seq2pipe** is a local AI agent that runs entirely on your own machine.
Give it your raw FASTQ data, and it automatically handles **pipeline design, execution, Python analysis, and report generation**.

- **Select Japanese or English at startup** â€” all AI responses and reports follow your choice
- Automatically checks for required Python packages (numpy / pandas / etc.) at startup
- Inspects your data structure automatically (FASTQ / metadata / existing QZA)
- Builds the right QIIME2 commands from scratch for your dataset
- Writes ready-to-run `.sh` / `.ps1` scripts
- **Two operation modes**: Mode 1 (specify your analysis in natural language) Â· Mode 2 (AI autonomously designs and runs all analyses, `--auto` flag)
- **Tool-calling code generation agent (vibe-local style)**: LLM first calls `read_file` to understand column names and data format before writing code â€” far fewer format errors; if an error occurs, `NEVER GIVE UP` â€” it rewrites and retries until EXIT CODE: 0
- Runs **Python downstream analysis** (pandas / scipy / scikit-learn / matplotlib) on QIIME2 outputs
- **Auto-saves all figures as PDF** â€” no need for view.qiime2.org
- **Autonomous analysis (Mode 2)**: Automatically generates 14 figures across 5 phases (PCA / PCoA / NMDS / rarefaction curves / taxonomy heatmap / sample correlation matrix / and more)
- **Auto-generates Japanese and English TeX / PDF reports** (`build_report_tex` programmatically builds TeX from ANALYSIS_LOG â€” no LLM context needed)

Everything runs **on your machine**. No cloud, no paid API, no internet required during analysis.

---

## Requirements

| | macOS | Linux | Windows |
|---|---|---|---|
| Python | 3.9+ | 3.9+ | 3.9+ |
| Ollama | auto via `setup.sh` | auto via `setup.sh` | auto via `setup.bat` |
| QIIME2 | conda env (recommended) or Docker | conda env or Docker Engine | Docker Desktop |
| Docker | Optional (not needed if QIIME2 conda env exists) | Optional | Docker Desktop |
| Python analysis packages | included in QIIME2 conda env | included in QIIME2 conda env | manual pip |
| RAM | 8 GB+ recommended | 8 GB+ recommended | 8 GB+ recommended |
| Disk | ~10 GB (LLM + QIIME2) | ~10 GB | ~10 GB |

**Python analysis packages** (auto-installed by `setup.sh`):
`numpy`, `pandas`, `matplotlib`, `seaborn`, `scipy`, `scikit-learn`, `biom-format`, `networkx`, `statsmodels`

---

## Install (3 steps)

### macOS

```bash
git clone https://github.com/Rhizobium-gits/seq2pipe.git
cd seq2pipe
chmod +x setup.sh launch.sh
./setup.sh      # first time only
./launch.sh     # start
```

### Linux (Ubuntu / Debian / Fedora / Arch etc.)

```bash
git clone https://github.com/Rhizobium-gits/seq2pipe.git
cd seq2pipe
chmod +x setup.sh launch.sh
./setup.sh      # first time only (auto-installs Docker Engine)
./launch.sh     # start
```

> On Linux, you may need to run `newgrp docker` or log out and back in after `setup.sh` completes.

### Windows

```
1. git clone https://github.com/Rhizobium-gits/seq2pipe.git
2. Open the seq2pipe folder
3. Double-click setup.bat (first time only)
4. Double-click launch.bat to start
```

Using PowerShell:

```powershell
Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy RemoteSigned
.\setup.ps1   # first time only
.\launch.ps1  # start
```

Install Python packages manually on Windows:

```powershell
pip install numpy pandas matplotlib seaborn scipy scikit-learn biom-format networkx statsmodels
```

---

## Usage

### QIIME2 pipeline generation

```
AI: Hello! To get started, please tell me:
    1. Path to your data directory
    2. Experimental description (region, primers, comparison groups)
    3. Desired analyses
    4. Figure style preferences (optional)

You > Data: /Users/yourname/microbiome-data/
      Experiment: Human gut, 16S V3-V4 (341F/806R), MiSeq PE 2Ã—250bp,
                  control (5) vs treatment (5)
      Analyses: Taxonomic composition + alpha/beta diversity + differential abundance
      Style: white background, blue palette

[Tool: inspect_directory]
  -> 10 paired-end FASTQ samples detected, metadata.tsv found...

[Tool: set_plot_config]
  -> style: seaborn-v0_8-whitegrid, palette: Blues

AI: Generating V3-V4 pipeline.
    Applying trim-left-f=17, trunc-f=270.
    -> manifest.tsv, run_pipeline.sh, setup_classifier.sh, ANALYSIS_README.md
```

### Autonomous agent mode (Mode 2 / --auto)

After QIIME2, the AI autonomously generates 14 figures across 5 phases â€” no user prompts needed.
**Vibe-local style**: The LLM first calls `read_file` to inspect column names and file format before writing code. If an error occurs, it rewrites and retries until EXIT CODE: 0.

```
$ ~/miniforge3/envs/qiime2/bin/python ~/seq2pipe/cli.py --auto --manifest manifest.tsv

  [Rainbow banner animation]

  Mode: Autonomous agent (max 40 steps)

  ğŸš€ STEP 1/2: Running QIIME2 pipeline
    -> dada2 denoise-paired, classify-sklearn, core-metrics-phylogenetic...
  âœ… Pipeline complete â†’ ~/seq2pipe_results/20260225_120000/

  ğŸ¤– STEP 2/2: Autonomous agent (tool-calling loop)

  [list_files] Enumerate exported files
    -> feature_table: 1 / taxonomy: 1 / alpha: 4 / beta: 4

  [Phase 0: Quality check]
  [read_file]  denoising/stats.tsv (verify column names)
  [write_file] quality_plot.py
  [run_python] EXIT CODE: 0 â†’ denoising_stats.pdf

  [Phase 1: Alpha diversity]
  [read_file]  alpha/shannon_vector.tsv (column: sample-id, shannon_entropy)
  [write_file] alpha_diversity.py
  [run_python] EXIT CODE: 0 â†’ alpha_diversity.pdf (Shannon/Chao1/Simpson/Faith's PD)

  [Phase 2: Beta diversity]
  [read_file]  beta/bray_curtis_pcoa_results.tsv
  [write_file] beta_diversity.py (PCoA + CLR-PCA + NMDS + rarefaction curves)
  [run_python] EXIT CODE: 0 â†’ beta_pcoa.pdf / beta_clr_pca.pdf / beta_nmds.pdf / rarefaction.pdf

  [Phase 3: Taxonomy]
  [read_file]  taxonomy/taxonomy.tsv + feature-table.tsv
  [write_file] taxonomy_plot.py (phylum stacked bar + genus heatmap + CLR bar)
  [run_python] EXIT CODE: 0 â†’ taxonomy_barplot.pdf / taxonomy_heatmap.pdf / taxonomy_clr.pdf

  [Phase 4: Sample correlation]
  [write_file] correlation_plot.py
  [run_python] EXIT CODE: 0 â†’ sample_correlation.pdf

  âœ… Autonomous analysis complete! (5 phases / 14 figures)
```

### Analysis mode (Mode 1) â€” natural language requests

Specify the analysis you want in natural language. The LLM reads the files first to understand the format, then generates accurate code.

```
$ ~/miniforge3/envs/qiime2/bin/python ~/seq2pipe/cli.py --export-dir ~/seq2pipe_results/20260225_120000/exported/

Select mode:
  1. Analysis mode     Specify what you want in natural language
  2. Autonomous agent  AI automatically runs all analyses

Choice (1/2) [1]: 1
Enter your request: Shannon diversity violin plot by group with Mann-Whitney U p-values

[list_files] List exported files
[read_file]  alpha/shannon_vector.tsv  (columns: sample-id, shannon_entropy)
[write_file] analysis.py (violin plot + statistical test)
[run_python] EXIT CODE: 0
  -> ~/seq2pipe_results/20260225_120000/figures/shannon_violin.pdf

âœ… Analysis complete!
ğŸ“Š Generated figures (1):
   /Users/yourname/seq2pipe_results/20260225_120000/figures/shannon_violin.pdf
```

### Figure style control

```
You > Switch to publication quality â€” 300 DPI PNG

[Tool: set_plot_config]
  -> dpi: 300, format: png applied to all subsequent figures
```

### Output file structure

```
<your data directory>/
â”œâ”€â”€ manifest.tsv              # QIIME2 import manifest
â”œâ”€â”€ setup_classifier.sh       # SILVA 138 classifier setup
â”œâ”€â”€ run_pipeline.sh           # Full analysis pipeline
â”œâ”€â”€ results/
â”‚   â”œâ”€â”€ table.qza             <- OTU/ASV feature table
â”‚   â”œâ”€â”€ taxonomy.qza          <- Classification results
â”‚   â”œâ”€â”€ core-metrics-results/ <- Diversity analysis
â”‚   â””â”€â”€ ancombc-results.qza   <- Differential abundance (optional)
â””â”€â”€ ANALYSIS_README.md        <- Data-specific operation guide

~/seq2pipe_results/<timestamp>/       <- auto-created per session
â”œâ”€â”€ figures/
â”‚   â”œâ”€â”€ alpha_diversity/      <- Phase 1: Shannon, Simpson, Chao1
â”‚   â”‚   â”œâ”€â”€ alpha_boxplot.pdf
â”‚   â”‚   â””â”€â”€ alpha_stats.pdf
â”‚   â”œâ”€â”€ beta_diversity/       <- Phase 2: PCoA, PERMANOVA
â”‚   â”‚   â””â”€â”€ pcoa_bray_curtis.pdf
â”‚   â”œâ”€â”€ taxonomy/             <- Phase 3: bar chart, heatmap
â”‚   â”‚   â”œâ”€â”€ taxonomy_barplot.pdf
â”‚   â”‚   â””â”€â”€ taxonomy_heatmap.pdf
â”‚   â”œâ”€â”€ differential_abundance/ <- Phase 4: volcano plot
â”‚   â”‚   â””â”€â”€ volcano_plot.pdf
â”‚   â”œâ”€â”€ machine_learning/     <- Phase 5: RF, AUC, feature importance
â”‚   â”‚   â””â”€â”€ feature_importance.pdf
â”‚   â””â”€â”€ <other manual analysis figures>
â””â”€â”€ report/
    â”œâ”€â”€ report_ja.tex / report_ja.pdf   <- Japanese report (auto-generated)
    â””â”€â”€ report_en.tex / report_en.pdf   <- English report (auto-generated)
```

### Viewing results

| Output | How to view |
|---|---|
| Python figures (.pdf / .png) | Open directly in any PDF viewer or image viewer |
| QIIME2 `.qzv` (interactive) | Drop into [https://view.qiime2.org](https://view.qiime2.org) |
| Report PDF | Open in any PDF viewer |

---

## Supported analyses

### QIIME2 core
| Analysis | Command |
|---|---|
| Import & demultiplex | `qiime tools import` |
| DADA2 denoising | `qiime dada2 denoise-paired/single` |
| Taxonomic classification (SILVA 138) | `qiime feature-classifier classify-sklearn` |
| Composition bar chart | `qiime taxa barplot` |
| Alpha & beta diversity | `qiime diversity core-metrics-phylogenetic` |
| Differential abundance ANCOM-BC | `qiime composition ancombc` |

### Python downstream (code_agent.py â€” tool-calling agent)
| Phase | Analysis | Packages |
|---|---|---|
| Phase 0 (quality) | Denoising statistics (input / filtered / denoised / non-chimeric) | pandas, matplotlib |
| Phase 1 (alpha) | Shannon / Chao1 / Simpson / Faith's PD + Mann-Whitney U + Kruskal-Wallis | pandas, scipy, seaborn |
| Phase 2 (beta) | Bray-Curtis PCoA Â· UniFrac PCoA + CLR-PCA + NMDS + rarefaction curves | pandas, sklearn, scipy |
| Phase 3 (taxonomy) | Phylum stacked bar + genus heatmap + CLR-transformed phylum bar | pandas, seaborn |
| Phase 4 (correlation) | Sample correlation matrix + hierarchical clustering heatmap | pandas, seaborn, scipy |
| Mode 1 | Any user-requested analysis (natural language â†’ read_file â†’ codegen â†’ auto-fix) | dynamic install support |
| Report | ANALYSIS_LOG â†’ TeX â†’ PDF (pure Python, no LLM, fast) | tectonic (TeX â†’ PDF) |

---

## Environment variables

| Variable | Default | Description |
|---|---|---|
| `QIIME2_AI_MODEL` | `qwen2.5-coder:7b` | Ollama model to use |
| `SEQ2PIPE_AUTO_YES` | `0` | Set to `1` to skip command confirmation (autonomous mode) |
| `SEQ2PIPE_MAX_STEPS` | `100` | Maximum agent loop steps |
| `SEQ2PIPE_PYTHON_TIMEOUT` | `600` | Timeout in seconds for `execute_python` |
| `QIIME2_CONDA_BIN` | auto-detected | Path to QIIME2 conda env bin directory (manual override) |

```bash
# Example: autonomous mode (no confirmation prompts)
SEQ2PIPE_AUTO_YES=1 ./launch.sh

# Example: manually specify QIIME2 conda env
QIIME2_CONDA_BIN=/opt/conda/envs/qiime2/bin ./launch.sh
```

---

## Models

| Model | RAM | Description |
|---|---|---|
| `qwen2.5-coder:7b` | 8 GB+ | Best for code generation (recommended) |
| `qwen2.5-coder:3b` | 4 GB+ | Lightweight and fast |
| `llama3.2:3b` | 4 GB+ | General purpose, good conversation |
| `qwen3:8b` | 16 GB+ | Highest quality, strong reasoning |

To use a different model:

```bash
# macOS / Linux
QIIME2_AI_MODEL=qwen2.5-coder:3b ./launch.sh

# Windows (PowerShell)
$env:QIIME2_AI_MODEL = "qwen2.5-coder:3b"; .\launch.ps1
```

---

## Architecture

```
You
  |
  v
[ launch.sh / launch.bat ]  â†’  [ cli.py ]  â† Entry point (rainbow banner / mode selection)
                                    |
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          |                         |                          |
          v                         v                          v
  Mode 1: Analysis mode     [ pipeline_runner.py ]     Mode 2: Autonomous agent
  (natural language)         QIIME2 pipeline +           (--auto flag)
                             result export
          |                         |                          |
          v                         v                          v
  [ code_agent.py ]  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  [ code_agent.py ]
    Tool-calling code generation agent
    |
    +---> Ollama (localhost:11434)  <-- Local LLM
    |       TOOL FIRST: read files before writing code
    |       NEVER GIVE UP: write_file to fix â†’ run_python again until EXIT CODE: 0
    |
    +-- list_files      (enumerate exported directory)
    +-- read_file       (feed file contents to LLM â†’ understand column names & format)
    +-- write_file      (atomic write via mkstemp+replace â€” safe script generation)
    +-- run_python      (execute with QIIME2 conda Python â†’ check exit code)
    `-- install_package (detect ModuleNotFoundError â†’ pip install + user approval)

  Autonomous task (Mode 2): 5 phases Â· 14 figures
    Phase 0: Quality check (denoising statistics)
    Phase 1: Alpha diversity (Shannon / Chao1 / Simpson / Faith's PD + stats)
    Phase 2: Beta diversity (Bray-Curtis PCoA / UniFrac PCoA / CLR-PCA / NMDS / rarefaction)
    Phase 3: Taxonomy (phylum stacked bar / genus heatmap / CLR phylum bar)
    Phase 4: Sample correlation (correlation matrix + hierarchical clustering)

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  [ qiime2_agent.py ]  QIIME2 pipeline generation (used inside pipeline_runner.py)
    |
    +---> Ollama (localhost:11434)  <-- Local LLM
    +---> 11 tools
            +-- inspect_directory  (scan data structure)
            +-- read_file          (read file contents)
            +-- write_file         (write scripts & README)
            +-- edit_file          (patch generated scripts)
            +-- generate_manifest  (create QIIME2 manifest)
            +-- run_command        (run QIIME2: auto-detects conda env / Docker fallback)
            +-- check_system       (verify environment)
            +-- set_plot_config    (style / palette / DPI / format)
            +-- execute_python     (Python analysis & visualization)
            +-- build_report_tex   (auto-build TeX/PDF from ANALYSIS_LOG)
            `-- log_analysis_step  (register QIIME2 steps in ANALYSIS_LOG)
```

---

## Troubleshooting

<details>
<summary>Cannot connect to Ollama</summary>

```bash
# macOS / Linux
ollama serve

# Windows (PowerShell)
Start-Process ollama -ArgumentList "serve"
```

</details>

<details>
<summary>QIIME2 conda env not detected automatically</summary>

Specify it manually with `QIIME2_CONDA_BIN`:

```bash
QIIME2_CONDA_BIN=/opt/conda/envs/qiime2/bin ./launch.sh
```

Auto-detected paths: `~/miniforge3/envs/qiime2/bin`, `~/miniconda3/envs/qiime2/bin`, `~/anaconda3/envs/qiime2/bin`

</details>

<details>
<summary>Docker not found / not running</summary>

Docker is not required if a QIIME2 conda env is detected.
Docker is only needed as a fallback when no conda env is available.

- macOS / Windows: Start Docker Desktop
- Linux: `sudo systemctl start docker`

</details>

<details>
<summary>Linux: docker permission denied</summary>

```bash
sudo usermod -aG docker $USER
newgrp docker
```

</details>

<details>
<summary>Python analysis packages missing</summary>

```bash
pip install numpy pandas matplotlib seaborn scipy scikit-learn biom-format networkx statsmodels
```

</details>

<details>
<summary>tectonic (PDF compilation) not found</summary>

```bash
# macOS
brew install tectonic

# Linux
curl --proto '=https' --tlsv1.2 -fsSL https://drop.rs/tectonic | sh
```

</details>

<details>
<summary>Model is slow / responses take too long</summary>

Switch to a lighter model if RAM is limited:

```bash
QIIME2_AI_MODEL=qwen2.5-coder:3b ./launch.sh
```

</details>

<details>
<summary>classify-sklearn memory error</summary>

Increase Docker Desktop memory to 8 GB or more, then tell the agent:

```
"I got a memory error. Please fix it with --p-n-jobs 1"
```

</details>

<details>
<summary>Windows: execution policy error</summary>

```powershell
Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy RemoteSigned
```

</details>

---

## File structure

```
seq2pipe/
â”œâ”€â”€ cli.py            # Entry point (rainbow banner / mode selection / CLI args)
â”œâ”€â”€ qiime2_agent.py   # QIIME2 pipeline generation agent (11 tools)
â”œâ”€â”€ pipeline_runner.py # QIIME2 execution wrapper + result export
â”œâ”€â”€ code_agent.py     # Tool-calling code generation agent (5 tools, vibe-local style)
â”œâ”€â”€ launch.sh         # macOS / Linux launcher
â”œâ”€â”€ launch.ps1        # Windows launcher (PowerShell)
â”œâ”€â”€ launch.bat        # Windows launcher (double-click)
â”œâ”€â”€ setup.sh          # macOS / Linux setup
â”œâ”€â”€ setup.ps1         # Windows setup (PowerShell)
â”œâ”€â”€ setup.bat         # Windows setup (double-click)
â”œâ”€â”€ LICENSE           # MIT License
â””â”€â”€ README.md         # This file
```

---

## Contributors

| | Name | Role |
|---|---|---|
| [@Rhizobium-gits](https://github.com/Rhizobium-gits) | Rhizobium-gits | Author |
| [@claude-bot](https://github.com/claude-bot) | Claude (Anthropic) | Co-author â€” design & implementation |

---

## References

- [QIIME2 Official Documentation](https://docs.qiime2.org/)
- [QIIME2 View (interactive visualization)](https://view.qiime2.org)
- [QIIME2 Forum](https://forum.qiime2.org/)
- [SILVA Database](https://www.arb-silva.de/)
- [Ollama](https://ollama.com/)

---

## License

- This tool: MIT License
- SILVA 138 data: [CC BY 4.0](https://creativecommons.org/licenses/by/4.0/)
- QIIME2: BSD License
