```
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â•šâ•â•â•â•â–ˆâ–ˆâ•—
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•”â•â•
 â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â–„â–„ â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â–€â–€â•â• â•šâ•â•â•â•â•â•
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â•
 â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â•šâ•â•     â•šâ•â•â•šâ•â•     â•šâ•â•â•â•â•â•â•
      sequence -> pipeline
```

> **ãƒ­ãƒ¼ã‚«ãƒ« LLM ã§ QIIME2 ãƒã‚¤ã‚¯ãƒ­ãƒã‚¤ã‚ªãƒ¼ãƒ è§£æã‚’è‡ªå‹•åŒ– â€” ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ»API ã‚­ãƒ¼ä¸è¦ãƒ»ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹**

---

## æ—¥æœ¬èª | [English](#english)

---

## ã“ã‚Œã¯ä½•ï¼Ÿ

**seq2pipe** ã¯ã€ã‚ãªãŸã® PC ã§å‹•ããƒ­ãƒ¼ã‚«ãƒ« AI ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã™ã€‚
ç”Ÿã® FASTQ ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™ã ã‘ã§ã€QIIME2 è§£æãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®**è¨­è¨ˆãƒ»å®Ÿè¡Œãƒ»Python è§£æãƒ»ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ**ã¾ã§è‡ªå‹•ã§è¡Œã„ã¾ã™ã€‚

- **èµ·å‹•æ™‚ã«æ—¥æœ¬èª / è‹±èªã‚’é¸æŠ**ã—ã€ä»¥é™ã® AI å¿œç­”ãƒ»ãƒ¬ãƒãƒ¼ãƒˆã‚’çµ±ä¸€
- èµ·å‹•æ™‚ã« Python ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆnumpy / pandas ç­‰ï¼‰ã®å­˜åœ¨ã‚’è‡ªå‹•ç¢ºèª
- ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’è‡ªå‹•ã§èª¿æŸ»ï¼ˆFASTQ / ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ / æ—¢å­˜ QZAï¼‰
- ãƒ‡ãƒ¼ã‚¿ã«åˆã£ãŸ QIIME2 ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚¼ãƒ­ã‹ã‚‰çµ„ã¿ç«‹ã¦ã‚‹
- ã™ãå®Ÿè¡Œã§ãã‚‹ `.sh` / `.ps1` ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›¸ãå‡ºã™
- **2 ã¤ã®æ“ä½œãƒ¢ãƒ¼ãƒ‰**: ãƒãƒ£ãƒƒãƒˆï¼ˆè‡ªç„¶è¨€èªã§ã‚„ã‚ŠãŸã„è§£æã‚’æŒ‡å®šï¼‰ãƒ»è‡ªå¾‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆAI ãŒè‡ªå¾‹çš„ã«å…¨è§£æã‚’è¨­è¨ˆãƒ»å®Ÿè¡Œï¼‰
- **ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—å‹ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆvibe-local æ–¹å¼ï¼‰**: LLM ãŒã¾ãš `read_file` ã§ãƒ‡ãƒ¼ã‚¿ã®åˆ—åãƒ»å½¢å¼ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ç²¾åº¦ãŒé«˜ãã€ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã‚‚ `NEVER GIVE UP` ã§è‡ªå‹•ä¿®æ­£ã‚’ç¹°ã‚Šè¿”ã™
- QIIME2 ã®å‡ºåŠ›ã‚’ **Pythonï¼ˆpandas / scipy / scikit-learn / matplotlibï¼‰ã§é«˜åº¦è§£æ**
- è§£æå›³ã‚’ã™ã¹ã¦ **PNG/PDF ã¨ã—ã¦è‡ªå‹•ä¿å­˜**ï¼ˆview.qiime2.org ä¸è¦ï¼‰
- **è‡ªå¾‹è§£æï¼ˆchat_agent / InteractiveSessionï¼‰**: Î±å¤šæ§˜æ€§ãƒ»Î²å¤šæ§˜æ€§ãƒ»DADA2 çµ±è¨ˆãªã©ã‚’è‡ªå‹•ç”Ÿæˆ
- è§£æçµ‚äº†å¾Œã« **æ—¥æœ¬èªãƒ»è‹±èªã® TeX / PDF ãƒ¬ãƒãƒ¼ãƒˆã‚’è‡ªå‹•ç”Ÿæˆ**

ã™ã¹ã¦ **ã‚ãªãŸã®ãƒã‚·ãƒ³ä¸Š** ã§å®Œçµã€‚ã‚¯ãƒ©ã‚¦ãƒ‰ã‚„æœ‰æ–™ API ã¯ä¸€åˆ‡ä½¿ã„ã¾ã›ã‚“ã€‚

---

## ãƒ‡ãƒ¢å‡ºåŠ› â€” å®Ÿéš›ã®è§£æçµæœ

ãƒ’ãƒˆä¾¿æ¤œä½“ 10 ã‚µãƒ³ãƒ—ãƒ«ï¼ˆTEST01ã€œTEST10ã€å‡çµä¹¾ç‡¥ä¾¿ã€Illumina MiSeq ãƒšã‚¢ã‚¨ãƒ³ãƒ‰ V3-V4ï¼‰ã‚’ seq2pipe ã§è§£æã—ãŸå®Ÿéš›ã®å‡ºåŠ›ã§ã™ã€‚

### Î± å¤šæ§˜æ€§ â€” Shannon / Faith PD / Evenness / Observed Features

![Alpha Diversity](Figure/alpha_diversity.png)

### Î² å¤šæ§˜æ€§ â€” Bray-Curtis PCoA

![Bray-Curtis PCoA](Figure/bray_curtis_pcoa.png)

### Î² å¤šæ§˜æ€§ â€” UniFrac (unweighted) PCoA

![UniFrac PCoA](Figure/unifrac_pcoa.png)

### Î² å¤šæ§˜æ€§ â€” Jaccard è·é›¢ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—

![Jaccard Heatmap](Figure/jaccard_heatmap.png)

### DADA2 ãƒ‡ãƒã‚¤ã‚¸ãƒ³ã‚°çµ±è¨ˆ

![DADA2 Stats](Figure/dada2_stats.png)

### Shannon å¤šæ§˜æ€§ï¼ˆæ°´å¹³ãƒã‚¤ã‚ªãƒªãƒ³ãƒ—ãƒ­ãƒƒãƒˆï¼‰

![Shannon Violin](Figure/shannon_violin.png)

> ä¸Šè¨˜ã™ã¹ã¦ã®å›³ã¨è€ƒå¯Ÿã‚’å«ã‚€ PDF ãƒ¬ãƒãƒ¼ãƒˆã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™: [analysis_report.pdf](Figure/analysis_report.pdf)

---

## å¿…è¦ãªã‚‚ã®

| | macOS | Linux | Windows |
|---|---|---|---|
| Python | 3.9 ä»¥ä¸Š | 3.9 ä»¥ä¸Š | 3.9 ä»¥ä¸Š |
| Ollama | `setup.sh` ã§è‡ªå‹• | `setup.sh` ã§è‡ªå‹• | `setup.bat` ã§è‡ªå‹• |
| QIIME2 | conda ç’°å¢ƒï¼ˆæ¨å¥¨ï¼‰ã¾ãŸã¯ Docker | conda ç’°å¢ƒã¾ãŸã¯ Docker Engine | Docker Desktop |
| Docker | ä»»æ„ï¼ˆQIIME2 conda env ãŒã‚ã‚Œã°ä¸è¦ï¼‰ | ä»»æ„ | Docker Desktop |
| Python è§£æãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | QIIME2 conda env ã«å«ã¾ã‚Œã‚‹ | QIIME2 conda env ã«å«ã¾ã‚Œã‚‹ | æ‰‹å‹• pip |
| RAM | 8 GB ä»¥ä¸Šæ¨å¥¨ | 8 GB ä»¥ä¸Šæ¨å¥¨ | 8 GB ä»¥ä¸Šæ¨å¥¨ |
| ãƒ‡ã‚£ã‚¹ã‚¯ | ç´„ 10 GBï¼ˆLLM + QIIME2ï¼‰ | ç´„ 10 GB | ç´„ 10 GB |

**Python è§£æãƒ‘ãƒƒã‚±ãƒ¼ã‚¸**ï¼ˆ`setup.sh` ãŒè‡ªå‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼‰:
`numpy`, `pandas`, `matplotlib`, `seaborn`, `scipy`, `scikit-learn`, `biom-format`, `networkx`, `statsmodels`

---

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆ3 ã‚¹ãƒ†ãƒƒãƒ—ï¼‰

### macOS

```bash
git clone https://github.com/Rhizobium-gits/seq2pipe.git
cd seq2pipe
chmod +x setup.sh launch.sh
./setup.sh      # åˆå›ã®ã¿ï¼ˆOllama + Python ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ + Docker ç¢ºèªï¼‰
./launch.sh     # èµ·å‹•
```

### Linuxï¼ˆUbuntu / Debian / Fedora / Arch ãªã©ï¼‰

```bash
git clone https://github.com/Rhizobium-gits/seq2pipe.git
cd seq2pipe
chmod +x setup.sh launch.sh
./setup.sh      # åˆå›ã®ã¿ï¼ˆDocker Engine ã‚’è‡ªå‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼‰
./launch.sh     # èµ·å‹•
```

> Linux ã®å ´åˆã€`setup.sh` å®Œäº†å¾Œã« `newgrp docker` ã¾ãŸã¯å†ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ãªå ´åˆãŒã‚ã‚Šã¾ã™ã€‚

### Windows

```
1. git clone https://github.com/Rhizobium-gits/seq2pipe.git
2. seq2pipe ãƒ•ã‚©ãƒ«ãƒ€ã‚’é–‹ã
3. setup.bat ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ï¼ˆåˆå›ã®ã¿ï¼‰
4. launch.bat ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã—ã¦èµ·å‹•
```

PowerShell ã‚’ä½¿ã†å ´åˆ:

```powershell
Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy RemoteSigned
.\setup.ps1   # åˆå›ã®ã¿
.\launch.ps1  # èµ·å‹•
```

Windows ã® Python è§£æãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯æ‰‹å‹•ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„:

```powershell
pip install numpy pandas matplotlib seaborn scipy scikit-learn biom-format networkx statsmodels
```

---

## èµ·å‹•æ–¹æ³•

```bash
./launch.sh     # macOS / Linux
.\launch.bat    # Windows
```

èµ·å‹•ã™ã‚‹ã¨è¨€èªé¸æŠï¼ˆæ—¥æœ¬èª / Englishï¼‰ã®å¾Œã€å¯¾è©±å‹ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒå§‹ã¾ã‚Šã¾ã™ã€‚

> **ãƒ–ãƒ©ã‚¦ã‚¶ GUI ãŒå¿…è¦ãªå ´åˆï¼ˆä»»æ„ï¼‰:** `app.py`ï¼ˆStreamlitï¼‰ã‚’åˆ©ç”¨ã§ãã¾ã™ãŒã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ« CLI ãŒæ¨™æº–ã®ä½¿ç”¨æ–¹æ³•ã§ã™ã€‚

---

## ä½¿ã„æ–¹

### QIIME2 ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ç”Ÿæˆï¼ˆCLIï¼‰

èµ·å‹•ã™ã‚‹ã¨ã€ã¾ãšè¨€èªã‚’é¸æŠã—ã¦ã‹ã‚‰ AI ãŒãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚

```
è¨€èªã‚’é¸æŠã—ã¦ãã ã•ã„ / Select language:
  1. æ—¥æœ¬èª (ja)
  2. English (en)
> 1

AI: ã“ã‚“ã«ã¡ã¯ï¼ä»¥ä¸‹ã‚’æ•™ãˆã¦ãã ã•ã„:
    1. ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ‘ã‚¹
    2. å®Ÿé¨“ç³»ã®èª¬æ˜ï¼ˆé ˜åŸŸãƒ»ãƒ—ãƒ©ã‚¤ãƒãƒ¼ãƒ»æ¯”è¼ƒã‚°ãƒ«ãƒ¼ãƒ—ï¼‰
    3. è¡Œã„ãŸã„è§£æ
    4. å›³ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆçœç•¥å¯ï¼‰

ã‚ãªãŸ > ãƒ‡ãƒ¼ã‚¿: /Users/yourname/microbiome-data/
         å®Ÿé¨“ç³»: ãƒ’ãƒˆè…¸å†…ç´°èŒã€16S V3-V4ï¼ˆ341F/806Rï¼‰ã€MiSeq PE 2Ã—250bp
                 ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« 5 ã‚µãƒ³ãƒ—ãƒ« vs å‡¦ç†ç¾¤ 5 ã‚µãƒ³ãƒ—ãƒ«
         è§£æ: åˆ†é¡çµ„æˆ + Î±/Î² å¤šæ§˜æ€§ + å·®æ¬¡è§£æ

[ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œ: inspect_directory]
  -> ãƒšã‚¢ã‚¨ãƒ³ãƒ‰ FASTQ 10 ã‚µãƒ³ãƒ—ãƒ«ã‚’æ¤œå‡ºã€metadata.tsv ã‚‚ç¢ºèª...

AI: V3-V4 ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ã¾ã™ã€‚
    -> manifest.tsv, run_pipeline.sh, ANALYSIS_README.md
```

### è‡ªå¾‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ¢ãƒ¼ãƒ‰ 2 / --autoï¼‰

QIIME2 è§£æå¾Œã€AI ãŒè‡ªå¾‹çš„ã«å¤šæ§˜æ€§ãƒ»çµ±è¨ˆå›³ã‚’å…¨è‡ªå‹•ã§ç”Ÿæˆã—ã¾ã™ã€‚

```
$ ~/miniforge3/envs/qiime2/bin/python ~/seq2pipe/cli.py --auto --manifest manifest.tsv

  ğŸš€ STEP 1/2: QIIME2 ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œä¸­
    -> dada2 denoise-paired, core-metrics-phylogenetic...
  âœ… ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Œäº†

  ğŸ¤– STEP 2/2: chat_agent è‡ªå¾‹è§£æ

  [Step 1] Î± å¤šæ§˜æ€§ 4 æŒ‡æ¨™ï¼ˆ2Ã—2 ã‚°ãƒªãƒƒãƒ‰ï¼‰
  [Step 2] Bray-Curtis PCoA
  [Step 3] UniFrac PCoA
  [Step 4] Jaccard ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—
  [Step 5] DADA2 çµ±è¨ˆæ£’ã‚°ãƒ©ãƒ•

  âœ… è‡ªå¾‹è§£æå®Œäº†ï¼PDF ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ â†’ report_ja.pdf
```

### è§£æãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ¢ãƒ¼ãƒ‰ 1ï¼‰- è‡ªç„¶è¨€èªã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

```
$ ~/miniforge3/envs/qiime2/bin/python ~/seq2pipe/cli.py --export-dir ~/seq2pipe_results/20260225_120000/exported/

ã‚„ã‚ŠãŸã„è§£æã‚’å…¥åŠ›: Shannon å¤šæ§˜æ€§ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã« violin plot ã§æ¯”è¼ƒ

[read_file]  alpha/shannon_vector.tsvï¼ˆåˆ—åç¢ºèªï¼‰
[write_file] analysis.py ã‚’ç”Ÿæˆ
[run_python] EXIT CODE: 0
  -> figures/shannon_violin.png ä¿å­˜

âœ… è§£æå®Œäº†ï¼
```

### å›³ã®ã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ›´

```
ã‚ãªãŸ > å›³ã‚’è«–æ–‡å‘ã‘ã« 300 DPI ã® PNG ã«å¤‰ãˆã¦

[ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œ: set_plot_config]
  -> dpi: 300, format: png ã«å¤‰æ›´
```

### ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«

```
~/seq2pipe_results/<ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—>/
â”œâ”€â”€ exported/                 â† QIIME2 ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿
â”‚   â”œâ”€â”€ feature-table.tsv
â”‚   â”œâ”€â”€ alpha/<æŒ‡æ¨™>/alpha-diversity.tsv
â”‚   â”œâ”€â”€ beta/<è¡Œåˆ—>/distance-matrix.tsv
â”‚   â””â”€â”€ denoising_stats/stats.tsv
â”œâ”€â”€ figures/
â”‚   â”œâ”€â”€ alpha_diversity.png   â† Î± å¤šæ§˜æ€§ 4 ãƒ‘ãƒãƒ«
â”‚   â”œâ”€â”€ bray_curtis_pcoa.png  â† Bray-Curtis PCoA
â”‚   â”œâ”€â”€ unifrac_pcoa.png      â† UniFrac PCoA
â”‚   â”œâ”€â”€ jaccard_heatmap.png   â† Jaccard ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—
â”‚   â”œâ”€â”€ dada2_stats.png       â† DADA2 ãƒ‡ãƒã‚¤ã‚¸ãƒ³ã‚°çµ±è¨ˆ
â”‚   â””â”€â”€ shannon_violin.png    â† Shannon ãƒã‚¤ã‚ªãƒªãƒ³
â””â”€â”€ report/
    â”œâ”€â”€ report_ja.tex         â† æ—¥æœ¬èªãƒ¬ãƒãƒ¼ãƒˆï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
    â””â”€â”€ report_ja.pdf         â† æ—¥æœ¬èª PDFï¼ˆå…¨å›³å…¥ã‚Šï¼‰
```

---

## å¯¾å¿œè§£æä¸€è¦§

### QIIME2 ã‚³ã‚¢è§£æ
| è§£æ | ã‚³ãƒãƒ³ãƒ‰ |
|---|---|
| ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ»ãƒ‡ãƒãƒ«ãƒãƒ—ãƒ¬ãƒƒã‚¯ã‚¹ | `qiime tools import` |
| DADA2 ãƒ‡ãƒã‚¤ã‚¸ãƒ³ã‚° | `qiime dada2 denoise-paired/single` |
| åˆ†é¡ï¼ˆSILVA 138ï¼‰ | `qiime feature-classifier classify-sklearn` |
| åˆ†é¡çµ„æˆãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆ | `qiime taxa barplot` |
| Î±ãƒ»Î² å¤šæ§˜æ€§ | `qiime diversity core-metrics-phylogenetic` |
| å·®æ¬¡è§£æ ANCOM-BC | `qiime composition ancombc` |

### Python ãƒ€ã‚¦ãƒ³ã‚¹ãƒˆãƒªãƒ¼ãƒ è§£æï¼ˆchat_agent / code_agent â€” LLM è‡ªå‹•ç”Ÿæˆï¼‰
| è§£ææ‰‹æ³• | ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ |
|---|---|
| Î± å¤šæ§˜æ€§ 4 æŒ‡æ¨™ï¼ˆShannon / Faith PD / Evenness / Observed Featuresï¼‰ | pandas, seaborn |
| Bray-Curtis PCoAï¼ˆsklearn MDSï¼‰ | pandas, sklearn |
| UniFrac PCoAï¼ˆunweighted / weightedï¼‰ | pandas, sklearn |
| Jaccard è·é›¢ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ï¼ˆseaborn clustermapï¼‰ | pandas, seaborn |
| DADA2 ãƒ‡ãƒã‚¤ã‚¸ãƒ³ã‚°çµ±è¨ˆæ£’ã‚°ãƒ©ãƒ• | pandas, matplotlib |
| Shannon ãƒã‚¤ã‚ªãƒªãƒ³ãƒ—ãƒ­ãƒƒãƒˆ | pandas, seaborn |
| é–€ãƒ»å±ãƒ¬ãƒ™ãƒ« stacked barï¼ˆtaxonomy ã‚ã‚Šï¼‰ | pandas, seaborn |
| å±ãƒ¬ãƒ™ãƒ« heatmapï¼ˆtaxonomy ã‚ã‚Šï¼‰ | pandas, seaborn |
| ã‚µãƒ³ãƒ—ãƒ«ç›¸é–¢è¡Œåˆ— | pandas, scipy, seaborn |
| TeX / PDF ãƒ¬ãƒãƒ¼ãƒˆè‡ªå‹•ç”Ÿæˆ | tectonic |

---

## ç’°å¢ƒå¤‰æ•°

| å¤‰æ•° | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|---|---|---|
| `QIIME2_AI_MODEL` | `qwen2.5-coder:7b` | ä½¿ç”¨ã™ã‚‹ Ollama ãƒ¢ãƒ‡ãƒ« |
| `SEQ2PIPE_AUTO_YES` | `0` | `1` ã«ã™ã‚‹ã¨ã‚³ãƒãƒ³ãƒ‰ç¢ºèªã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆè‡ªå¾‹ãƒ¢ãƒ¼ãƒ‰ï¼‰ |
| `SEQ2PIPE_MAX_STEPS` | `100` | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ«ãƒ¼ãƒ—ã®æœ€å¤§ã‚¹ãƒ†ãƒƒãƒ—æ•° |
| `SEQ2PIPE_PYTHON_TIMEOUT` | `600` | `execute_python` ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆç§’æ•° |
| `QIIME2_CONDA_BIN` | è‡ªå‹•æ¤œå‡º | QIIME2 conda ç’°å¢ƒã® bin ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆæ‰‹å‹•æŒ‡å®šç”¨ï¼‰ |

```bash
# ä¾‹: è‡ªå¾‹ãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•ï¼ˆç¢ºèªãªã—ï¼‰
SEQ2PIPE_AUTO_YES=1 ./launch.sh

# ä¾‹: QIIME2 conda env ã‚’æ‰‹å‹•æŒ‡å®š
QIIME2_CONDA_BIN=/opt/conda/envs/qiime2/bin ./launch.sh
```

---

## ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«

| ãƒ¢ãƒ‡ãƒ« | RAM | ç‰¹å¾´ |
|---|---|---|
| `qwen2.5-coder:7b` | 8 GB ä»¥ä¸Š | ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã«æœ€é©ï¼ˆæ¨å¥¨ï¼‰ |
| `qwen2.5-coder:3b` | 4 GB ä»¥ä¸Š | è»½é‡ãƒ»é«˜é€Ÿ |
| `llama3.2:3b` | 4 GB ä»¥ä¸Š | æ±ç”¨ãƒ»ä¼šè©±èƒ½åŠ›é«˜ã‚ |
| `qwen3:8b` | 16 GB ä»¥ä¸Š | æœ€é«˜å“è³ªãƒ»æ¨è«–èƒ½åŠ›ã‚‚é«˜ã„ |

### å°å‹ãƒ¢ãƒ‡ãƒ«ã¸ã®å¯¾å¿œï¼ˆãƒ­ãƒã‚¹ãƒˆãƒã‚¹æ©Ÿèƒ½ï¼‰

7B ä»¥ä¸‹ã®å°å‹ãƒ¢ãƒ‡ãƒ«ã§ã¯ Ollama ã® tool_calls ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«éå¯¾å¿œã®ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
seq2pipe ã¯ä»¥ä¸‹ã®å¤šå±¤ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿæ§‹ã§ã“ã‚Œã‚’è‡ªå‹•çš„ã«è£œã„ã¾ã™:

1. **`_parse_text_tool_calls`**: ãƒ†ã‚­ã‚¹ãƒˆæœ¬æ–‡ã«åŸ‹ã‚è¾¼ã¾ã‚ŒãŸ JSON ã‚’ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã¨ã—ã¦è§£æï¼ˆ5 ãƒ‘ã‚¿ãƒ¼ãƒ³å¯¾å¿œï¼‰
2. **Auto-inject `run_python`**: `write_file` ã§ .py ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ã„ãŸç›´å¾Œã€ãƒ¢ãƒ‡ãƒ«ãŒ `run_python` ã‚’å‘¼ã¶ã®ã‚’å¾…ãŸãšã«è‡ªå‹•å®Ÿè¡Œ
3. **ã‚¹ãƒ†ãƒƒãƒ— 6 ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ãƒ«ãƒ¼ãƒ—ãŒ 5 ã‚¹ãƒ†ãƒƒãƒ—é€²ã¾ãªã„å ´åˆã¯è‡ªå‹•çš„ã« 1 ã‚·ãƒ§ãƒƒãƒˆç”Ÿæˆï¼ˆ`run_code_agent`ï¼‰ã«åˆ‡ã‚Šæ›¿ãˆ
4. **ç¹°ã‚Šè¿”ã—æ¤œå‡º**: åŒã˜ 50 æ–‡å­—ãƒãƒ£ãƒ³ã‚¯ãŒ 4 å›é€£ç¶šã—ãŸã‚‰ç”Ÿæˆã‚’æ‰“ã¡åˆ‡ã‚Šï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—å›é¿ï¼‰

åˆ¥ã®ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ã†ã«ã¯:

```bash
QIIME2_AI_MODEL=qwen2.5-coder:3b ./launch.sh
```

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
ã‚ãªãŸ
  |
  v
[ launch.sh / cli.py ]  (ä»»æ„: app.py Streamlit GUI)
        |
        v
[ pipeline_runner.py ]  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  [ qiime2_agent.py ]
  QIIME2 ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œ                          QIIME2 ã‚³ãƒãƒ³ãƒ‰ç”Ÿæˆ
  (manifest ãƒ¢ãƒ³ã‚­ãƒ¼ãƒ‘ãƒƒãƒå¯¾å¿œ)                    (11 ãƒ„ãƒ¼ãƒ«)
        |
        v
[ chat_agent.py / InteractiveSession ]
  è‡ªå¾‹è§£æã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
  â”œâ”€â”€ plan_analysis_suite()  è§£æãƒ—ãƒ©ãƒ³ã‚’ LLM ã«ç”Ÿæˆã•ã›ã‚‹
  â”œâ”€â”€ run_planned(analyses)  è§£æãƒªã‚¹ãƒˆã‚’é †æ¬¡å®Ÿè¡Œ
  â””â”€â”€ generate_report()      TeX/PDF ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
        |
        v
[ code_agent.py / run_code_agent() ]
  LLM ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ â†’ ã‚µãƒ–ãƒ—ãƒ­ã‚»ã‚¹å®Ÿè¡Œ â†’ ã‚¨ãƒ©ãƒ¼æ™‚è‡ªå‹•ä¿®æ­£ï¼ˆæœ€å¤§ 3 å›ï¼‰
  â”œâ”€â”€ _ensure_required_imports()  plt/pd ã®è‡ªå‹•è£œå®Œ
  â”œâ”€â”€ ModuleNotFoundError æ¤œå‡º â†’ install_callback ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèª
  â””â”€â”€ å®Ÿè¡ŒæˆåŠŸ + å›³ç”Ÿæˆç¢ºèª â†’ CodeExecutionResult è¿”å´
        |
        v
  Ollama (localhost:11434)  â† ãƒ­ãƒ¼ã‚«ãƒ« LLM
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

<details>
<summary>Ollama ã«æ¥ç¶šã§ããªã„</summary>

```bash
ollama serve
```

</details>

<details>
<summary>QIIME2 conda ç’°å¢ƒãŒè‡ªå‹•æ¤œå‡ºã•ã‚Œãªã„</summary>

```bash
QIIME2_CONDA_BIN=/opt/conda/envs/qiime2/bin ./launch.sh
```

è‡ªå‹•æ¤œå‡ºã•ã‚Œã‚‹å€™è£œ: `~/miniforge3/envs/qiime2/bin`, `~/miniconda3/envs/qiime2/bin`, `~/anaconda3/envs/qiime2/bin`

</details>

<details>
<summary>Docker ãŒè¦‹ã¤ã‹ã‚‰ãªã„ / èµ·å‹•ã—ã¦ã„ãªã„</summary>

QIIME2 conda ç’°å¢ƒãŒæ¤œå‡ºã•ã‚Œã¦ã„ã‚‹å ´åˆã€Docker ã¯ä¸è¦ã§ã™ã€‚

- macOS / Windows: Docker Desktop ã‚’èµ·å‹•ã—ã¦ãã ã•ã„
- Linux: `sudo systemctl start docker`

</details>

<details>
<summary>Python è§£æãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒè¶³ã‚Šãªã„</summary>

```bash
pip install numpy pandas matplotlib seaborn scipy scikit-learn biom-format networkx statsmodels
```

</details>

<details>
<summary>tectonicï¼ˆPDF ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ï¼‰ãŒè¦‹ã¤ã‹ã‚‰ãªã„</summary>

```bash
# macOS
brew install tectonic

# Linux
curl --proto '=https' --tlsv1.2 -fsSL https://drop.rs/tectonic | sh
```

</details>

<details>
<summary>ãƒ¢ãƒ‡ãƒ«ãŒé‡ã„ / å¿œç­”ãŒé…ã„</summary>

```bash
QIIME2_AI_MODEL=qwen2.5-coder:3b ./launch.sh
```

</details>

<details>
<summary>Streamlit ãŒèµ·å‹•ã—ãªã„</summary>

```bash
~/miniforge3/envs/qiime2/bin/pip install streamlit
~/miniforge3/envs/qiime2/bin/streamlit run app.py
```

</details>

---

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
seq2pipe/
â”œâ”€â”€ cli.py             # ã‚¿ãƒ¼ãƒŸãƒŠãƒ« ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼ˆè™¹è‰²ãƒãƒŠãƒ¼ãƒ»ãƒ¢ãƒ¼ãƒ‰é¸æŠï¼‰
â”œâ”€â”€ chat_agent.py      # è‡ªå¾‹è§£æã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† + TeX/PDF ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
â”œâ”€â”€ app.py             # Streamlit ãƒ–ãƒ©ã‚¦ã‚¶ GUIï¼ˆä»»æ„ï¼‰
â”œâ”€â”€ qiime2_agent.py    # QIIME2 ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ç”Ÿæˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆ11 ãƒ„ãƒ¼ãƒ«ï¼‰
â”œâ”€â”€ pipeline_runner.py # QIIME2 å®Ÿè¡Œãƒ©ãƒƒãƒ‘ãƒ¼ + çµæœã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
â”œâ”€â”€ code_agent.py      # LLM ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆvibe-local æ–¹å¼ï¼‰
â”œâ”€â”€ _run_pipeline.py   # ãƒ•ãƒ«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆãƒãƒƒãƒç”¨ï¼‰
â”œâ”€â”€ _run_analysis.py   # è§£æã®ã¿å®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆæ—¢å­˜ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆç”¨ï¼‰
â”œâ”€â”€ Figure/            # ãƒ‡ãƒ¢å‡ºåŠ›å›³ï¼ˆå®Ÿãƒ‡ãƒ¼ã‚¿è§£æçµæœï¼‰
â”‚   â”œâ”€â”€ alpha_diversity.png
â”‚   â”œâ”€â”€ bray_curtis_pcoa.png
â”‚   â”œâ”€â”€ unifrac_pcoa.png
â”‚   â”œâ”€â”€ jaccard_heatmap.png
â”‚   â”œâ”€â”€ dada2_stats.png
â”‚   â”œâ”€â”€ shannon_violin.png
â”‚   â””â”€â”€ analysis_report.pdf
â”œâ”€â”€ Paper/             # æŠ€è¡“ãƒ¬ãƒãƒ¼ãƒˆï¼ˆTeX / PDFï¼‰
â”‚   â”œâ”€â”€ seq2pipe_ja.tex / seq2pipe_ja.pdf
â”‚   â””â”€â”€ seq2pipe_en.tex / seq2pipe_en.pdf
â”œâ”€â”€ launch.sh          # macOS / Linux èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ launch.ps1         # Windows èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆPowerShellï¼‰
â”œâ”€â”€ launch.bat         # Windows èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ç”¨ï¼‰
â”œâ”€â”€ setup.sh           # macOS / Linux ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
â”œâ”€â”€ setup.ps1          # Windows ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆPowerShellï¼‰
â”œâ”€â”€ setup.bat          # Windows ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ç”¨ï¼‰
â”œâ”€â”€ LICENSE            # MIT License
â””â”€â”€ README.md          # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

---

## Contributors

| | Name | Role |
|---|---|---|
| [@Rhizobium-gits](https://github.com/Rhizobium-gits) | Rhizobium-gits | Author |
| [@claude-bot](https://github.com/claude-bot) | Claude (Anthropic) | Co-author â€” design & implementation |

---

## å‚è€ƒãƒªãƒ³ã‚¯

- [QIIME2 å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.qiime2.org/)
- [QIIME2 Viewï¼ˆã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–å¯è¦–åŒ–ï¼‰](https://view.qiime2.org)
- [QIIME2 Forum](https://forum.qiime2.org/)
- [SILVA ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹](https://www.arb-silva.de/)
- [Ollama å…¬å¼ã‚µã‚¤ãƒˆ](https://ollama.com/)

---

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

- ã“ã®ãƒ„ãƒ¼ãƒ«: MIT License
- SILVA 138 ãƒ‡ãƒ¼ã‚¿: [CC BY 4.0](https://creativecommons.org/licenses/by/4.0/)
- QIIME2: BSD License

---
---

<a name="english"></a>

# English

```
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â•šâ•â•â•â•â–ˆâ–ˆâ•—
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•”â•â•
 â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â–„â–„ â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â–€â–€â•â• â•šâ•â•â•â•â•â•
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â•
 â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â•šâ•â•     â•šâ•â•â•šâ•â•     â•šâ•â•â•â•â•â•â•
      sequence -> pipeline
```

> **Automate QIIME2 microbiome analysis with a local LLM â€” offline, no API key, open source**

[æ—¥æœ¬èª](#æ—¥æœ¬èª--english)

---

## What is this?

**seq2pipe** is a local AI agent that runs entirely on your own machine.
Give it your raw FASTQ data, and it automatically handles **pipeline design, execution, Python analysis, and report generation**.

- **Select Japanese or English at startup** â€” all AI responses and reports follow your choice
- Automatically checks for required Python packages (numpy / pandas / etc.) at startup
- Inspects your data structure automatically (FASTQ / metadata / existing QZA)
- Builds the right QIIME2 commands from scratch for your dataset
- Writes ready-to-run `.sh` / `.ps1` scripts
- **Two operation modes**: Chat (specify analysis in natural language) Â· Autonomous agent (AI designs and runs all analyses)
- **Tool-calling code generation agent (vibe-local style)**: LLM first calls `read_file` to understand column names and data format before writing code â€” far fewer format errors; if an error occurs, `NEVER GIVE UP` â€” it rewrites and retries until EXIT CODE: 0
- Runs **Python downstream analysis** (pandas / scipy / scikit-learn / matplotlib) on QIIME2 outputs
- **Auto-saves all figures as PNG/PDF** â€” no need for view.qiime2.org
- **Autonomous analysis (chat_agent / InteractiveSession)**: Auto-generates Î±/Î² diversity, DADA2 statistics, and more
- **Auto-generates Japanese and English TeX / PDF reports**

Everything runs **on your machine**. No cloud, no paid API, no internet required during analysis.

---

## Demo Output â€” Real Analysis Results

Actual output from seq2pipe on 10 human stool samples (TEST01â€“TEST10, freeze-dried, Illumina MiSeq paired-end V3-V4):

### Alpha Diversity â€” Shannon / Faith PD / Evenness / Observed Features

![Alpha Diversity](Figure/alpha_diversity.png)

### Beta Diversity â€” Bray-Curtis PCoA

![Bray-Curtis PCoA](Figure/bray_curtis_pcoa.png)

### Beta Diversity â€” UniFrac (unweighted) PCoA

![UniFrac PCoA](Figure/unifrac_pcoa.png)

### Beta Diversity â€” Jaccard Distance Heatmap

![Jaccard Heatmap](Figure/jaccard_heatmap.png)

### DADA2 Denoising Statistics

![DADA2 Stats](Figure/dada2_stats.png)

### Shannon Diversity (Horizontal Violin Plot)

![Shannon Violin](Figure/shannon_violin.png)

> An automatically generated PDF report including all figures and discussion: [analysis_report.pdf](Figure/analysis_report.pdf)

---

## Requirements

| | macOS | Linux | Windows |
|---|---|---|---|
| Python | 3.9+ | 3.9+ | 3.9+ |
| Ollama | auto via `setup.sh` | auto via `setup.sh` | auto via `setup.bat` |
| QIIME2 | conda env (recommended) or Docker | conda env or Docker Engine | Docker Desktop |
| Docker | Optional (not needed if QIIME2 conda env exists) | Optional | Docker Desktop |
| Python analysis packages | included in QIIME2 conda env | included in QIIME2 conda env | manual pip |
| RAM | 8 GB+ recommended | 8 GB+ recommended | 8 GB+ recommended |
| Disk | ~10 GB (LLM + QIIME2) | ~10 GB | ~10 GB |

**Python analysis packages** (auto-installed by `setup.sh`):
`numpy`, `pandas`, `matplotlib`, `seaborn`, `scipy`, `scikit-learn`, `biom-format`, `networkx`, `statsmodels`

---

## Install (3 steps)

### macOS

```bash
git clone https://github.com/Rhizobium-gits/seq2pipe.git
cd seq2pipe
chmod +x setup.sh launch.sh
./setup.sh      # first time only
./launch.sh     # start
```

### Linux (Ubuntu / Debian / Fedora / Arch etc.)

```bash
git clone https://github.com/Rhizobium-gits/seq2pipe.git
cd seq2pipe
chmod +x setup.sh launch.sh
./setup.sh      # first time only (auto-installs Docker Engine)
./launch.sh     # start
```

> On Linux, you may need to run `newgrp docker` or log out and back in after `setup.sh` completes.

### Windows

```
1. git clone https://github.com/Rhizobium-gits/seq2pipe.git
2. Open the seq2pipe folder
3. Double-click setup.bat (first time only)
4. Double-click launch.bat to start
```

Using PowerShell:

```powershell
Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy RemoteSigned
.\setup.ps1   # first time only
.\launch.ps1  # start
```

Install Python packages manually on Windows:

```powershell
pip install numpy pandas matplotlib seaborn scipy scikit-learn biom-format networkx statsmodels
```

---

## Launch

```bash
./launch.sh     # macOS / Linux
.\launch.bat    # Windows
```

After launching, select your language (Japanese / English) and an interactive terminal session begins.

> **Optional browser GUI:** `app.py` (Streamlit) is available for those who prefer a browser interface, but the terminal CLI is the standard way to use seq2pipe.

---

## Usage

### Autonomous agent mode (--auto)

After QIIME2, the AI autonomously generates diversity and statistics figures.

```
$ ~/miniforge3/envs/qiime2/bin/python ~/seq2pipe/cli.py --auto --manifest manifest.tsv

  ğŸš€ STEP 1/2: Running QIIME2 pipeline
    -> dada2 denoise-paired, core-metrics-phylogenetic...
  âœ… Pipeline complete

  ğŸ¤– STEP 2/2: chat_agent autonomous analysis

  [Step 1] Alpha diversity 4-panel (2Ã—2 grid)
  [Step 2] Bray-Curtis PCoA
  [Step 3] UniFrac PCoA
  [Step 4] Jaccard heatmap
  [Step 5] DADA2 denoising statistics

  âœ… Analysis complete! PDF report â†’ report_ja.pdf
```

### Analysis mode (Mode 1) â€” natural language requests

```
$ ~/miniforge3/envs/qiime2/bin/python ~/seq2pipe/cli.py --export-dir ~/seq2pipe_results/.../exported/

Enter request: Shannon diversity violin plot by group

[read_file]  alpha/shannon_vector.tsv (check column names)
[write_file] analysis.py
[run_python] EXIT CODE: 0 â†’ figures/shannon_violin.png

âœ… Analysis complete!
```

### Output file structure

```
~/seq2pipe_results/<timestamp>/
â”œâ”€â”€ exported/                  â† QIIME2 exported data
â”‚   â”œâ”€â”€ feature-table.tsv
â”‚   â”œâ”€â”€ alpha/<metric>/alpha-diversity.tsv
â”‚   â”œâ”€â”€ beta/<matrix>/distance-matrix.tsv
â”‚   â””â”€â”€ denoising_stats/stats.tsv
â”œâ”€â”€ figures/
â”‚   â”œâ”€â”€ alpha_diversity.png    â† Alpha diversity 4-panel
â”‚   â”œâ”€â”€ bray_curtis_pcoa.png   â† Bray-Curtis PCoA
â”‚   â”œâ”€â”€ unifrac_pcoa.png       â† UniFrac PCoA
â”‚   â”œâ”€â”€ jaccard_heatmap.png    â† Jaccard heatmap
â”‚   â”œâ”€â”€ dada2_stats.png        â† DADA2 denoising statistics
â”‚   â””â”€â”€ shannon_violin.png     â† Shannon violin plot
â””â”€â”€ report/
    â”œâ”€â”€ report_ja.tex          â† Japanese report (auto-generated)
    â””â”€â”€ report_ja.pdf          â† Japanese PDF (all figures included)
```

---

## Supported analyses

### QIIME2 core
| Analysis | Command |
|---|---|
| Import & demultiplex | `qiime tools import` |
| DADA2 denoising | `qiime dada2 denoise-paired/single` |
| Taxonomic classification (SILVA 138) | `qiime feature-classifier classify-sklearn` |
| Composition bar chart | `qiime taxa barplot` |
| Alpha & beta diversity | `qiime diversity core-metrics-phylogenetic` |
| Differential abundance ANCOM-BC | `qiime composition ancombc` |

### Python downstream (chat_agent / code_agent â€” LLM auto-generated)
| Analysis | Packages |
|---|---|
| Alpha diversity 4-panel (Shannon / Faith PD / Evenness / Observed Features) | pandas, seaborn |
| Bray-Curtis PCoA (sklearn MDS) | pandas, sklearn |
| UniFrac PCoA (unweighted / weighted) | pandas, sklearn |
| Jaccard distance heatmap (seaborn clustermap) | pandas, seaborn |
| DADA2 denoising statistics bar chart | pandas, matplotlib |
| Shannon violin plot | pandas, seaborn |
| Phylum/genus stacked bar (with taxonomy) | pandas, seaborn |
| Genus-level heatmap (with taxonomy) | pandas, seaborn |
| Sample correlation matrix | pandas, scipy, seaborn |
| TeX / PDF report auto-generation | tectonic |

---

## Environment variables

| Variable | Default | Description |
|---|---|---|
| `QIIME2_AI_MODEL` | `qwen2.5-coder:7b` | Ollama model to use |
| `SEQ2PIPE_AUTO_YES` | `0` | Set to `1` to skip command confirmation (autonomous mode) |
| `SEQ2PIPE_MAX_STEPS` | `100` | Maximum agent loop steps |
| `SEQ2PIPE_PYTHON_TIMEOUT` | `600` | Timeout in seconds for `execute_python` |
| `QIIME2_CONDA_BIN` | auto-detected | Path to QIIME2 conda env bin directory (manual override) |

---

## Models

| Model | RAM | Description |
|---|---|---|
| `qwen2.5-coder:7b` | 8 GB+ | Best for code generation (recommended) |
| `qwen2.5-coder:3b` | 4 GB+ | Lightweight and fast |
| `llama3.2:3b` | 4 GB+ | General purpose, good conversation |
| `qwen3:8b` | 16 GB+ | Highest quality, strong reasoning |

---

## Architecture

```
You
  |
  v
[ launch.sh / cli.py ]  (optional: app.py Streamlit GUI)
        |
        v
[ pipeline_runner.py ]  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  [ qiime2_agent.py ]
  QIIME2 pipeline execution                        QIIME2 command generation
  (manifest monkey-patch support)                  (11 tools)
        |
        v
[ chat_agent.py / InteractiveSession ]
  Autonomous analysis session management
  â”œâ”€â”€ plan_analysis_suite()   LLM generates analysis plan
  â”œâ”€â”€ run_planned(analyses)   Execute analysis steps in sequence
  â””â”€â”€ generate_report()       Build TeX/PDF report
        |
        v
[ code_agent.py / run_code_agent() ]
  LLM code generation â†’ subprocess execution â†’ auto-fix on error (max 3 retries)
  â”œâ”€â”€ _ensure_required_imports()  auto-inject plt/pd if missing
  â”œâ”€â”€ ModuleNotFoundError â†’ install_callback for user approval
  â””â”€â”€ success + figure check â†’ return CodeExecutionResult
        |
        v
  Ollama (localhost:11434)  â† Local LLM
```

---

## Troubleshooting

<details>
<summary>Cannot connect to Ollama</summary>

```bash
ollama serve
```

</details>

<details>
<summary>QIIME2 conda env not detected automatically</summary>

```bash
QIIME2_CONDA_BIN=/opt/conda/envs/qiime2/bin ./launch.sh
```

</details>

<details>
<summary>Docker not found / not running</summary>

Docker is not required if a QIIME2 conda env is detected.

- macOS / Windows: Start Docker Desktop
- Linux: `sudo systemctl start docker`

</details>

<details>
<summary>Python analysis packages missing</summary>

```bash
pip install numpy pandas matplotlib seaborn scipy scikit-learn biom-format networkx statsmodels
```

</details>

<details>
<summary>tectonic (PDF compilation) not found</summary>

```bash
# macOS
brew install tectonic

# Linux
curl --proto '=https' --tlsv1.2 -fsSL https://drop.rs/tectonic | sh
```

</details>

<details>
<summary>Streamlit won't start</summary>

```bash
~/miniforge3/envs/qiime2/bin/pip install streamlit
~/miniforge3/envs/qiime2/bin/streamlit run app.py
```

</details>

---

## File structure

```
seq2pipe/
â”œâ”€â”€ cli.py             # Terminal entry point (rainbow banner / mode selection)
â”œâ”€â”€ chat_agent.py      # Autonomous analysis session + TeX/PDF report
â”œâ”€â”€ app.py             # Streamlit browser GUI (optional)
â”œâ”€â”€ qiime2_agent.py    # QIIME2 pipeline generation agent (11 tools)
â”œâ”€â”€ pipeline_runner.py # QIIME2 execution wrapper + result export
â”œâ”€â”€ code_agent.py      # LLM code generation agent (vibe-local style)
â”œâ”€â”€ _run_pipeline.py   # Full pipeline batch script
â”œâ”€â”€ _run_analysis.py   # Analysis-only batch script (for existing exports)
â”œâ”€â”€ Figure/            # Demo output figures (real data analysis results)
â”‚   â”œâ”€â”€ alpha_diversity.png
â”‚   â”œâ”€â”€ bray_curtis_pcoa.png
â”‚   â”œâ”€â”€ unifrac_pcoa.png
â”‚   â”œâ”€â”€ jaccard_heatmap.png
â”‚   â”œâ”€â”€ dada2_stats.png
â”‚   â”œâ”€â”€ shannon_violin.png
â”‚   â””â”€â”€ analysis_report.pdf
â”œâ”€â”€ Paper/             # Technical report (TeX / PDF)
â”‚   â”œâ”€â”€ seq2pipe_ja.tex / seq2pipe_ja.pdf
â”‚   â””â”€â”€ seq2pipe_en.tex / seq2pipe_en.pdf
â”œâ”€â”€ launch.sh          # macOS / Linux launcher
â”œâ”€â”€ launch.ps1         # Windows launcher (PowerShell)
â”œâ”€â”€ launch.bat         # Windows launcher (double-click)
â”œâ”€â”€ setup.sh           # macOS / Linux setup
â”œâ”€â”€ setup.ps1          # Windows setup (PowerShell)
â”œâ”€â”€ setup.bat          # Windows setup (double-click)
â”œâ”€â”€ LICENSE            # MIT License
â””â”€â”€ README.md          # This file
```

---

## Contributors

| | Name | Role |
|---|---|---|
| [@Rhizobium-gits](https://github.com/Rhizobium-gits) | Rhizobium-gits | Author |
| [@claude-bot](https://github.com/claude-bot) | Claude (Anthropic) | Co-author â€” design & implementation |

---

## References

- [QIIME2 Official Documentation](https://docs.qiime2.org/)
- [QIIME2 View (interactive visualization)](https://view.qiime2.org)
- [QIIME2 Forum](https://forum.qiime2.org/)
- [SILVA Database](https://www.arb-silva.de/)
- [Ollama](https://ollama.com/)

---

## License

- This tool: MIT License
- SILVA 138 data: [CC BY 4.0](https://creativecommons.org/licenses/by/4.0/)
- QIIME2: BSD License
