```
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â•šâ•â•â•â•â–ˆâ–ˆâ•—
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•”â•â•
 â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â–„â–„ â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â–€â–€â•â• â•šâ•â•â•â•â•â•
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â•
 â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â•šâ•â•     â•šâ•â•â•šâ•â•     â•šâ•â•â•â•â•â•â•
      sequence -> pipeline
```

> **ãƒ­ãƒ¼ã‚«ãƒ« LLM ã§ QIIME2 ãƒã‚¤ã‚¯ãƒ­ãƒã‚¤ã‚ªãƒ¼ãƒ è§£æã‚’è‡ªå‹•åŒ– â€” ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ»API ã‚­ãƒ¼ä¸è¦ãƒ»ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹**

---

## æ—¥æœ¬èª | [English](#english)

---

## ã“ã‚Œã¯ä½•ï¼Ÿ

**seq2pipe** ã¯ã€ã‚ãªãŸã® PC ã§å‹•ããƒ­ãƒ¼ã‚«ãƒ« AI ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã™ã€‚
ç”Ÿã® FASTQ ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™ã ã‘ã§ã€QIIME2 è§£æãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®**è¨­è¨ˆãƒ»å®Ÿè¡Œãƒ»Python è§£æãƒ»å›³ã®ä¿®æ­£ãƒ»ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ**ã¾ã§è‡ªå‹•ã§è¡Œã„ã¾ã™ã€‚

- **èµ·å‹•æ™‚ã«æ—¥æœ¬èª / è‹±èªã‚’é¸æŠ**ã—ã€ä»¥é™ã® AI å¿œç­”ãƒ»ãƒ¬ãƒãƒ¼ãƒˆã‚’çµ±ä¸€
- èµ·å‹•æ™‚ã« Python ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆnumpy / pandas ç­‰ï¼‰ã®å­˜åœ¨ã‚’è‡ªå‹•ç¢ºèª
- ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’è‡ªå‹•ã§èª¿æŸ»ï¼ˆFASTQ / ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ / æ—¢å­˜ QZAï¼‰
- ãƒ‡ãƒ¼ã‚¿ã«åˆã£ãŸ QIIME2 ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚¼ãƒ­ã‹ã‚‰çµ„ã¿ç«‹ã¦ã‚‹
- ã™ãå®Ÿè¡Œã§ãã‚‹ `.sh` / `.ps1` ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›¸ãå‡ºã™
- **2 ã¤ã®æ“ä½œãƒ¢ãƒ¼ãƒ‰**: ãƒãƒ£ãƒƒãƒˆï¼ˆè‡ªç„¶è¨€èªã§ã‚„ã‚ŠãŸã„è§£æã‚’æŒ‡å®šï¼‰ãƒ»è‡ªå¾‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆAI ãŒè‡ªå¾‹çš„ã«å…¨è§£æã‚’è¨­è¨ˆãƒ»å®Ÿè¡Œï¼‰
- **3 ã‚¹ãƒ†ãƒƒãƒ—è‡ªå‹•è§£æãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆ`--auto` ãƒ¢ãƒ¼ãƒ‰ï¼‰**:
  - **STEP 1**: QIIME2 ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆDADA2 ãƒ‡ãƒã‚¤ã‚¸ãƒ³ã‚° â†’ ç³»çµ±æ¨¹ â†’ å¤šæ§˜æ€§è§£æ â†’ åˆ†é¡å­¦çš„è§£æï¼‰
  - **STEP 2**: æ±ºå®šè«–çš„åŒ…æ‹¬è§£æï¼ˆ`analysis.py`ï¼‰â€” LLM ã«ä¾å­˜ã›ãš **15 ç¨®é¡ã®å‡ºç‰ˆå“è³ª PNG å›³ã‚’ç¢ºå®Ÿã«ç”Ÿæˆ**
  - **STEP 3**: HTML ãƒ¬ãƒãƒ¼ãƒˆè‡ªå‹•ç”Ÿæˆ
- **ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—å‹ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆvibe-local æ–¹å¼ï¼‰**: LLM ãŒã¾ãš `read_file` ã§ãƒ‡ãƒ¼ã‚¿ã®åˆ—åãƒ»å½¢å¼ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ç²¾åº¦ãŒé«˜ãã€ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã‚‚ `NEVER GIVE UP` ã§è‡ªå‹•ä¿®æ­£ã‚’ç¹°ã‚Šè¿”ã™
- **è§£æå¾Œã®æŒ¯ã‚Šè¿”ã‚Šãƒ»ä¿®æ­£ãƒ¢ãƒ¼ãƒ‰**: ç”Ÿæˆã•ã‚ŒãŸå›³ã«å¯¾ã—ã¦ã€Œè‰²ã‚’å¤‰ãˆã¦ã€ã€Œå‡¡ä¾‹ã‚’å¤–ã«å‡ºã—ã¦ã€ãªã©è‡ªç„¶è¨€èªã§ä¿®æ­£ã‚’æŒ‡ç¤ºã—ã€LLM ãŒè‡ªå‹•ã§ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ãƒ»å†å®Ÿè¡Œ
- QIIME2 ã®å‡ºåŠ›ã‚’ **Pythonï¼ˆpandas / scipy / scikit-learn / matplotlib / seabornï¼‰ã§é«˜åº¦è§£æ**
- è§£æå›³ã‚’ã™ã¹ã¦ **PNG ã¨ã—ã¦è‡ªå‹•ä¿å­˜**ï¼ˆPDF/SVG ãŒå‡ºåŠ›ã•ã‚ŒãŸå ´åˆã‚‚ macOS å†…è”µ `sips` ã§è‡ªå‹•å¤‰æ›ï¼‰
- **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãªã—ã§ã‚‚å¤šæ§˜æ€§è§£æã‚’å®Ÿè¡Œ**: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ä¸è¦ã§ Î± å¤šæ§˜æ€§ãƒ»Î² å¤šæ§˜æ€§ã‚’è‡ªå‹•è¨ˆç®—
- **`--classifier` ã‚ªãƒ—ã‚·ãƒ§ãƒ³**: SILVA 138 åˆ†é¡å™¨ã®è‡ªå‹•æ¢ç´¢ãƒ»æŒ‡å®šã«ã‚ˆã‚‹åˆ†é¡å­¦çš„è§£æ
- è§£æçµ‚äº†å¾Œã« **HTML ãƒ¬ãƒãƒ¼ãƒˆã‚’è‡ªå‹•ç”Ÿæˆ**ï¼ˆ`--auto` ãƒ¢ãƒ¼ãƒ‰ï¼‰ã€ã¾ãŸã¯ãƒãƒ£ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰ã§ã€Œãƒ¬ãƒãƒ¼ãƒˆã€â†’ HTML / ã€ŒPDFã€â†’ LaTeX/PDF

ã™ã¹ã¦ **ã‚ãªãŸã®ãƒã‚·ãƒ³ä¸Š** ã§å®Œçµã€‚ã‚¯ãƒ©ã‚¦ãƒ‰ã‚„æœ‰æ–™ API ã¯ä¸€åˆ‡ä½¿ã„ã¾ã›ã‚“ã€‚

---

## ãƒ‡ãƒ¢å‡ºåŠ› â€” å®Ÿéš›ã®è§£æçµæœ

ãƒ’ãƒˆä¾¿æ¤œä½“ 10 ã‚µãƒ³ãƒ—ãƒ«ï¼ˆTEST01ã€œTEST10ã€å‡çµä¹¾ç‡¥ä¾¿ã€Illumina MiSeq ãƒšã‚¢ã‚¨ãƒ³ãƒ‰ V3-V4ï¼‰ã‚’ seq2pipe ã§è§£æã—ãŸå®Ÿéš›ã®å‡ºåŠ›ã§ã™ã€‚
ã™ã¹ã¦ `analysis.py`ï¼ˆSTEP 2ï¼‰ãŒæ±ºå®šè«–çš„ã«è‡ªå‹•ç”Ÿæˆã—ãŸ PNG å›³ã§ã™ã€‚

### DADA2 ãƒ‡ãƒã‚¤ã‚¸ãƒ³ã‚°çµ±è¨ˆ

![DADA2 Stats](Figure/fig01_dada2_stats.png)

### Î± å¤šæ§˜æ€§ â€” Shannon / Faith PD / Observed ASVs

![Alpha Diversity](Figure/fig03_alpha_diversity.png)

### Shannon å¤šæ§˜æ€§ï¼ˆã‚µãƒ³ãƒ—ãƒ«åˆ¥ã‚¹ãƒˆãƒªãƒƒãƒ—ãƒ—ãƒ­ãƒƒãƒˆï¼‰

![Shannon Per Sample](Figure/fig04_shannon_per_sample.png)

### Î² å¤šæ§˜æ€§ â€” Bray-Curtis PCoA

![Bray-Curtis PCoA](Figure/fig05_pcoa_braycurtis.png)

### Î² å¤šæ§˜æ€§ â€” Unweighted UniFrac PCoA

![UniFrac PCoA](Figure/fig07_pcoa_unweighted_unifrac.png)

### Î² å¤šæ§˜æ€§ â€” è·é›¢è¡Œåˆ—ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ï¼ˆ4 æŒ‡æ¨™ï¼‰

![Beta Heatmaps](Figure/fig09_beta_distance_heatmaps.png)

### åˆ†é¡çµ„æˆ â€” å±ãƒ¬ãƒ™ãƒ«ç©ã¿ä¸Šã’æ£’ã‚°ãƒ©ãƒ•

![Genus Composition](Figure/fig13_genus_composition.png)

### åˆ†é¡çµ„æˆ â€” å±ãƒ¬ãƒ™ãƒ«ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—

![Genus Heatmap](Figure/fig15_genus_heatmap.png)

> ä¸Šè¨˜ã‚’å«ã‚€å…¨ 15 å›³ã¯ `--auto` ãƒ¢ãƒ¼ãƒ‰ã§è‡ªå‹•ç”Ÿæˆã•ã‚Œã€HTML ãƒ¬ãƒãƒ¼ãƒˆã«ã¾ã¨ã‚ã‚‰ã‚Œã¾ã™ã€‚

---

## å¿…è¦ãªã‚‚ã®

| | macOS | Linux | Windows |
|---|---|---|---|
| Python | 3.9 ä»¥ä¸Š | 3.9 ä»¥ä¸Š | 3.9 ä»¥ä¸Š |
| Ollama | `setup.sh` ã§è‡ªå‹• | `setup.sh` ã§è‡ªå‹• | `setup.bat` ã§è‡ªå‹• |
| QIIME2 | conda ç’°å¢ƒï¼ˆæ¨å¥¨ï¼‰ã¾ãŸã¯ Docker | conda ç’°å¢ƒã¾ãŸã¯ Docker Engine | Docker Desktop |
| Docker | ä»»æ„ï¼ˆQIIME2 conda env ãŒã‚ã‚Œã°ä¸è¦ï¼‰ | ä»»æ„ | Docker Desktop |
| Python è§£æãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | QIIME2 conda env ã«å«ã¾ã‚Œã‚‹ | QIIME2 conda env ã«å«ã¾ã‚Œã‚‹ | æ‰‹å‹• pip |
| RAM | 8 GB ä»¥ä¸Šæ¨å¥¨ | 8 GB ä»¥ä¸Šæ¨å¥¨ | 8 GB ä»¥ä¸Šæ¨å¥¨ |
| ãƒ‡ã‚£ã‚¹ã‚¯ | ç´„ 10 GBï¼ˆLLM + QIIME2ï¼‰ | ç´„ 10 GB | ç´„ 10 GB |

**Python è§£æãƒ‘ãƒƒã‚±ãƒ¼ã‚¸**ï¼ˆ`setup.sh` ãŒè‡ªå‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼‰:
`numpy`, `pandas`, `matplotlib`, `seaborn`, `scipy`, `scikit-learn`, `biom-format`, `networkx`, `statsmodels`

---

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆ3 ã‚¹ãƒ†ãƒƒãƒ—ï¼‰

### macOS

```bash
git clone https://github.com/Rhizobium-gits/seq2pipe.git
cd seq2pipe
chmod +x setup.sh launch.sh
./setup.sh      # åˆå›ã®ã¿ï¼ˆOllama + Python ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ + Docker ç¢ºèªï¼‰
./launch.sh     # èµ·å‹•
```

### Linuxï¼ˆUbuntu / Debian / Fedora / Arch ãªã©ï¼‰

```bash
git clone https://github.com/Rhizobium-gits/seq2pipe.git
cd seq2pipe
chmod +x setup.sh launch.sh
./setup.sh      # åˆå›ã®ã¿ï¼ˆDocker Engine ã‚’è‡ªå‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼‰
./launch.sh     # èµ·å‹•
```

> Linux ã®å ´åˆã€`setup.sh` å®Œäº†å¾Œã« `newgrp docker` ã¾ãŸã¯å†ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ãªå ´åˆãŒã‚ã‚Šã¾ã™ã€‚

### Windows

```
1. git clone https://github.com/Rhizobium-gits/seq2pipe.git
2. seq2pipe ãƒ•ã‚©ãƒ«ãƒ€ã‚’é–‹ã
3. setup.bat ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ï¼ˆåˆå›ã®ã¿ï¼‰
4. launch.bat ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã—ã¦èµ·å‹•
```

PowerShell ã‚’ä½¿ã†å ´åˆ:

```powershell
Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy RemoteSigned
.\setup.ps1   # åˆå›ã®ã¿
.\launch.ps1  # èµ·å‹•
```

Windows ã® Python è§£æãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯æ‰‹å‹•ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„:

```powershell
pip install numpy pandas matplotlib seaborn scipy scikit-learn biom-format networkx statsmodels
```

---

## èµ·å‹•æ–¹æ³•

```bash
./launch.sh     # macOS / Linux
.\launch.bat    # Windows
```

èµ·å‹•ã™ã‚‹ã¨è¨€èªé¸æŠï¼ˆæ—¥æœ¬èª / Englishï¼‰ã®å¾Œã€å¯¾è©±å‹ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒå§‹ã¾ã‚Šã¾ã™ã€‚

---

## ä½¿ã„æ–¹

### ãƒ¢ãƒ¼ãƒ‰ 1 â€” è‡ªç„¶è¨€èªã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆæŒ‡å®šè§£æï¼‰

```
$ ./launch.sh --fastq-dir ~/input

ã‚„ã‚ŠãŸã„è§£æã‚’å…¥åŠ›: Shannon å¤šæ§˜æ€§ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã« violin plot ã§æ¯”è¼ƒ

[list_files]  ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’ç¢ºèª
[read_file]   alpha/shannon_vector.tsv ã®åˆ—åã‚’ç¢ºèª
[write_file]  analysis.py ã‚’ç”Ÿæˆ
[run_python]  EXIT CODE: 0 â†’ figures/shannon_violin.png ä¿å­˜

âœ… è§£æå®Œäº†ï¼

  âœï¸  æŒ¯ã‚Šè¿”ã‚Šãƒ»ä¿®æ­£ãƒ¢ãƒ¼ãƒ‰
  ç”Ÿæˆã•ã‚ŒãŸå›³ã«å¯¾ã—ã¦è‡ªç„¶è¨€èªã§ä¿®æ­£ã‚’æŒ‡ç¤ºã§ãã¾ã™ã€‚
  ä¾‹: ã€Œç©ã¿ä¸Šã’æ£’ã‚°ãƒ©ãƒ•ã®å‡¡ä¾‹ã‚’å¤–ã«å‡ºã—ã¦ã€
      ã€ŒPCoA ã®ç‚¹ã‚’å¤§ããã—ã¦ã€ã‚µãƒ³ãƒ—ãƒ«åã‚’è¡¨ç¤ºã—ã¦ã€
      ã€Œè‰²ç›²å¯¾å¿œã®ãƒ‘ãƒ¬ãƒƒãƒˆã«å¤‰ãˆã¦ã€
  ğŸ“„ ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›:
      HTML: ã€Œãƒ¬ãƒãƒ¼ãƒˆã€ã¨å…¥åŠ›
      PDF:  ã€ŒPDFãƒ¬ãƒãƒ¼ãƒˆã€ã¾ãŸã¯ã€ŒPDFã€ã¨å…¥åŠ›
  çµ‚äº†: ç©º Enter / quit / done

âœï¸  ä¿®æ­£å†…å®¹> PCoA ã®ç‚¹ã‚’å¤§ããã—ã¦ã‚µãƒ³ãƒ—ãƒ«åã‚‚è¡¨ç¤ºã—ã¦

[write_file] analysis.py ã‚’ä¿®æ­£
[run_python] EXIT CODE: 0 â†’ figures/fig10_beta_pcoa.png æ›´æ–°

âœï¸  ä¿®æ­£å†…å®¹> PDF

ğŸ“ PDF ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™ï¼ˆLaTeXï¼‰...
ğŸ“ LaTeX ã‚¨ãƒ³ã‚¸ãƒ³æ¤œå‡º: lualatex
âœ… PDF ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº†ï¼
ğŸ“„ ãƒ•ã‚¡ã‚¤ãƒ«: /path/to/results/report.pdf
```

### ãƒ¢ãƒ¼ãƒ‰ 2 â€” å®Œå…¨è‡ªå¾‹ï¼ˆ--autoï¼‰

FASTQ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®šã™ã‚‹ã ã‘ã§ã€QIIME2 ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ + æ±ºå®šè«–çš„è§£æ + ãƒ¬ãƒãƒ¼ãƒˆã¾ã§è‡ªå‹•å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
cd ~/seq2pipe
./launch.sh --fastq-dir ~/input --auto
```

```
  ğŸš€ STEP 1/3: QIIME2 ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œä¸­
    -> dada2 denoise-paired, phylogeny, diversity, taxonomy...
  âœ… ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Œäº†

  ğŸ“Š STEP 2/3: åŒ…æ‹¬çš„è§£æï¼ˆanalysis.pyï¼‰
    fig01 DADA2 ãƒ‡ãƒã‚¤ã‚¸ãƒ³ã‚°çµ±è¨ˆ        âœ…
    fig02 ã‚·ãƒ¼ã‚±ãƒ³ã‚·ãƒ³ã‚°æ·±åº¦            âœ…
    fig03 Î±å¤šæ§˜æ€§ï¼ˆShannon/Faith PD/Observed ASVsï¼‰  âœ…
    fig04 Shannon å¤šæ§˜æ€§ï¼ˆã‚µãƒ³ãƒ—ãƒ«åˆ¥ï¼‰     âœ…
    fig05 PCoA Bray-Curtis              âœ…
    fig06 PCoA Jaccard                  âœ…
    fig07 PCoA Unweighted UniFrac       âœ…
    fig08 PCoA Weighted UniFrac         âœ…
    fig09 Î²å¤šæ§˜æ€§è·é›¢ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—        âœ…
    fig10 Top 30 ASV ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—        âœ…
    fig11 Î±å¤šæ§˜æ€§ç›¸é–¢                   âœ…
    fig12 ASV ãƒªãƒƒãƒãƒã‚¹ vs æ·±åº¦         âœ…
    fig13 å±ãƒ¬ãƒ™ãƒ«çµ„æˆ                   âœ…
    fig14 é–€ãƒ¬ãƒ™ãƒ«çµ„æˆ                   âœ…
    fig15 å±ãƒ¬ãƒ™ãƒ«ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—            âœ…
  âœ… 15 å›³ã‚’ç”Ÿæˆã—ã¾ã—ãŸ

  ğŸ“„ STEP 3/3: HTML ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
  âœ… ãƒ¬ãƒãƒ¼ãƒˆå®Œäº†
```

### DADA2 ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è‡ªå‹•æ¤œå‡º

`--auto` ãƒ•ãƒ©ã‚°ä½¿ç”¨æ™‚ã€ãƒªãƒ¼ãƒ‰é•·ã‹ã‚‰ DADA2 ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è‡ªå‹•æ¤œå‡ºã—ã¾ã™:

```bash
./launch.sh --fastq-dir ~/input --auto
# â†’ trunc_len_f, trunc_len_r, sampling_depth ã‚’è‡ªå‹•æ¨å®š

# æ‰‹å‹•ä¸Šæ›¸ãã‚‚å¯èƒ½
./launch.sh --fastq-dir ~/input --auto \
  --trim-left-f 20 --trim-left-r 20 \
  --trunc-len-f 260 --trunc-len-r 230
```

### åˆ†é¡å­¦çš„è§£æï¼ˆ`--classifier`ï¼‰

SILVA 138 Naive Bayes åˆ†é¡å™¨ã‚’æŒ‡å®šã—ã¦åˆ†é¡å­¦çš„è§£æã‚’æœ‰åŠ¹åŒ–ã§ãã¾ã™:

```bash
# è‡ªå‹•æ¢ç´¢ï¼ˆseq2pipe ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«åˆ†é¡å™¨ãŒã‚ã‚‹å ´åˆï¼‰
./launch.sh --fastq-dir ~/input --auto

# æ˜ç¤ºçš„ã«æŒ‡å®š
./launch.sh --fastq-dir ~/input --auto --classifier ~/silva-138-99-nb-classifier.qza
```

åˆ†é¡å™¨ãŒæ¤œå‡ºã•ã‚Œã‚‹ã¨ã€QIIME2 ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§åˆ†é¡å­¦çš„è§£æãŒå®Ÿè¡Œã•ã‚Œã€
`analysis.py` ãŒå±ãƒ»é–€ãƒ¬ãƒ™ãƒ«ã®çµ„æˆå›³ï¼ˆfig13ã€œfig15ï¼‰ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚

### ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›

| å…¥åŠ›ä¾‹ | å‡ºåŠ› |
|--------|------|
| `--auto` ãƒ¢ãƒ¼ãƒ‰ | HTML ãƒ¬ãƒãƒ¼ãƒˆã‚’è‡ªå‹•ç”Ÿæˆï¼ˆSTEP 3/3ï¼‰ |
| `ãƒ¬ãƒãƒ¼ãƒˆ` / `html` | HTML ãƒ¬ãƒãƒ¼ãƒˆï¼ˆå›³ã‚’ base64 åŸ‹ã‚è¾¼ã¿ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãï¼‰ |
| `PDF` / `PDFãƒ¬ãƒãƒ¼ãƒˆ` / `latex` | LaTeX â†’ PDF ãƒ¬ãƒãƒ¼ãƒˆï¼ˆlualatex/xelatex ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ï¼‰ |

### ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«

```
~/seq2pipe_results/<ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—>/
â”œâ”€â”€ exported/                 â† QIIME2 ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿
â”‚   â”œâ”€â”€ feature-table.tsv
â”‚   â”œâ”€â”€ taxonomy/taxonomy.tsv
â”‚   â”œâ”€â”€ alpha/<æŒ‡æ¨™>/alpha-diversity.tsv
â”‚   â”œâ”€â”€ beta/<è¡Œåˆ—>/distance-matrix.tsv
â”‚   â””â”€â”€ denoising_stats/stats.tsv
â”œâ”€â”€ figures/                  â† ã™ã¹ã¦ PNG å½¢å¼ã§ä¿å­˜
â”‚   â”œâ”€â”€ fig01_dada2_stats.png
â”‚   â”œâ”€â”€ fig02_sequencing_depth.png
â”‚   â”œâ”€â”€ fig03_alpha_diversity.png
â”‚   â”œâ”€â”€ fig04_shannon_per_sample.png
â”‚   â”œâ”€â”€ fig05_pcoa_braycurtis.png
â”‚   â”œâ”€â”€ fig06_pcoa_jaccard.png
â”‚   â”œâ”€â”€ fig07_pcoa_unweighted_unifrac.png
â”‚   â”œâ”€â”€ fig08_pcoa_weighted_unifrac.png
â”‚   â”œâ”€â”€ fig09_beta_distance_heatmaps.png
â”‚   â”œâ”€â”€ fig10_top30_asv_heatmap.png
â”‚   â”œâ”€â”€ fig11_alpha_correlations.png
â”‚   â”œâ”€â”€ fig12_richness_vs_depth.png
â”‚   â”œâ”€â”€ fig13_genus_composition.png      â† åˆ†é¡å™¨ã‚ã‚Š
â”‚   â”œâ”€â”€ fig14_phylum_composition.png     â† åˆ†é¡å™¨ã‚ã‚Š
â”‚   â””â”€â”€ fig15_genus_heatmap.png          â† åˆ†é¡å™¨ã‚ã‚Š
â”œâ”€â”€ report.html               â† HTML ãƒ¬ãƒãƒ¼ãƒˆï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
â”œâ”€â”€ report.tex                â† LaTeX ã‚½ãƒ¼ã‚¹ï¼ˆã€ŒPDFã€ã§ç”Ÿæˆï¼‰
â””â”€â”€ report.pdf                â† PDF ãƒ¬ãƒãƒ¼ãƒˆï¼ˆlualatex/xelatex ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ï¼‰
```

---

## å¯¾å¿œè§£æä¸€è¦§

### QIIME2 ã‚³ã‚¢è§£æï¼ˆSTEP 1ï¼‰
| è§£æ | ã‚³ãƒãƒ³ãƒ‰ |
|---|---|
| ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ»ãƒ‡ãƒãƒ«ãƒãƒ—ãƒ¬ãƒƒã‚¯ã‚¹ | `qiime tools import` |
| DADA2 ãƒ‡ãƒã‚¤ã‚¸ãƒ³ã‚° | `qiime dada2 denoise-paired/single` |
| åˆ†é¡ï¼ˆSILVA 138ï¼‰ | `qiime feature-classifier classify-sklearn` |
| åˆ†é¡çµ„æˆãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆ | `qiime taxa barplot` |
| Î±ãƒ»Î² å¤šæ§˜æ€§ï¼ˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚ã‚Šï¼‰ | `qiime diversity core-metrics-phylogenetic` |
| Î±ãƒ»Î² å¤šæ§˜æ€§ï¼ˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãªã—ï¼‰ | `qiime diversity alpha` / `qiime diversity beta` ãªã©å€‹åˆ¥å®Ÿè¡Œ |
| å·®æ¬¡è§£æ ANCOM-BC | `qiime composition ancombc` |

### æ±ºå®šè«–çš„åŒ…æ‹¬è§£æï¼ˆSTEP 2 â€” `analysis.py`ã€LLM ä¸è¦ï¼‰
| å›³ç•ªå· | è§£æå†…å®¹ | ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ |
|---|---|---|
| fig01 | DADA2 ãƒ‡ãƒã‚¤ã‚¸ãƒ³ã‚°çµ±è¨ˆ | pandas, matplotlib |
| fig02 | ã‚·ãƒ¼ã‚±ãƒ³ã‚·ãƒ³ã‚°æ·±åº¦ï¼ˆã‚µãƒ³ãƒ—ãƒ«åˆ¥ï¼‰ | pandas, matplotlib |
| fig03 | Î± å¤šæ§˜æ€§ãƒœãƒƒã‚¯ã‚¹ãƒ—ãƒ­ãƒƒãƒˆï¼ˆShannon / Faith PD / Observed ASVsï¼‰ | pandas, seaborn |
| fig04 | Shannon å¤šæ§˜æ€§ï¼ˆã‚µãƒ³ãƒ—ãƒ«åˆ¥ã‚¹ãƒˆãƒªãƒƒãƒ—ãƒ—ãƒ­ãƒƒãƒˆï¼‰ | pandas, seaborn |
| fig05 | Bray-Curtis PCoA | pandas, sklearn (MDS) |
| fig06 | Jaccard PCoA | pandas, sklearn (MDS) |
| fig07 | Unweighted UniFrac PCoA | pandas, sklearn (MDS) |
| fig08 | Weighted UniFrac PCoA | pandas, sklearn (MDS) |
| fig09 | Î² å¤šæ§˜æ€§è·é›¢ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ï¼ˆ4 æŒ‡æ¨™ 2Ã—2ï¼‰ | pandas, seaborn |
| fig10 | Top 30 ASV ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ— | pandas, seaborn |
| fig11 | Î± å¤šæ§˜æ€§ç›¸é–¢ãƒ—ãƒ­ãƒƒãƒˆ | pandas, matplotlib |
| fig12 | ASV ãƒªãƒƒãƒãƒã‚¹ vs ã‚·ãƒ¼ã‚±ãƒ³ã‚·ãƒ³ã‚°æ·±åº¦ | pandas, matplotlib |
| fig13 | å±ãƒ¬ãƒ™ãƒ«ç©ã¿ä¸Šã’æ£’ã‚°ãƒ©ãƒ•ï¼ˆåˆ†é¡å™¨ã‚ã‚Šï¼‰ | pandas, matplotlib |
| fig14 | é–€ãƒ¬ãƒ™ãƒ«ç©ã¿ä¸Šã’æ£’ã‚°ãƒ©ãƒ•ï¼ˆåˆ†é¡å™¨ã‚ã‚Šï¼‰ | pandas, matplotlib |
| fig15 | å±ãƒ¬ãƒ™ãƒ«ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ï¼ˆåˆ†é¡å™¨ã‚ã‚Šï¼‰ | pandas, seaborn |

### Python ãƒ€ã‚¦ãƒ³ã‚¹ãƒˆãƒªãƒ¼ãƒ è§£æï¼ˆLLM ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ â€” ãƒ¢ãƒ¼ãƒ‰ 1ï¼‰
| è§£ææ‰‹æ³• | ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ |
|---|---|
| Î± å¤šæ§˜æ€§ 4 æŒ‡æ¨™ï¼ˆShannon / Faith PD / Evenness / Observed Featuresï¼‰ | pandas, seaborn |
| Bray-Curtis PCoAï¼ˆsklearn MDSï¼‰ | pandas, sklearn |
| UniFrac PCoAï¼ˆunweighted / weightedï¼‰ | pandas, sklearn |
| NMDSï¼ˆBray-Curtis éè¨ˆé‡å¤šæ¬¡å…ƒå°ºåº¦æ³•ï¼‰ | pandas, sklearn |
| CLR å¤‰æ› PCAï¼ˆçµ„æˆãƒ‡ãƒ¼ã‚¿å‘ã‘ä¸»æˆåˆ†åˆ†æï¼‰ | pandas, sklearn |
| é–€ãƒ»å±ãƒ¬ãƒ™ãƒ« stacked barï¼ˆtaxonomy ã‚ã‚Šï¼‰ | pandas, seaborn |
| å±ãƒ¬ãƒ™ãƒ« heatmapï¼ˆtaxonomy ã‚ã‚Šï¼‰ | pandas, seaborn |
| ã‚µãƒ³ãƒ—ãƒ«ç›¸é–¢è¡Œåˆ— | pandas, scipy, seaborn |
| HTML / LaTeX+PDF ãƒ¬ãƒãƒ¼ãƒˆè‡ªå‹•ç”Ÿæˆ | report_generator.pyï¼ˆlualatex / xelatexï¼‰ |

---

## ç’°å¢ƒå¤‰æ•°

| å¤‰æ•° | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|---|---|---|
| `QIIME2_AI_MODEL` | `qwen2.5-coder:7b` | ä½¿ç”¨ã™ã‚‹ Ollama ãƒ¢ãƒ‡ãƒ« |
| `SEQ2PIPE_AUTO_YES` | `0` | `1` ã«ã™ã‚‹ã¨ã‚³ãƒãƒ³ãƒ‰ç¢ºèªã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆè‡ªå¾‹ãƒ¢ãƒ¼ãƒ‰ï¼‰ |
| `SEQ2PIPE_MAX_STEPS` | `100` | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ«ãƒ¼ãƒ—ã®æœ€å¤§ã‚¹ãƒ†ãƒƒãƒ—æ•° |
| `SEQ2PIPE_PYTHON_TIMEOUT` | `600` | Python å®Ÿè¡Œã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆç§’æ•° |
| `QIIME2_CONDA_BIN` | è‡ªå‹•æ¤œå‡º | QIIME2 conda ç’°å¢ƒã® bin ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆæ‰‹å‹•æŒ‡å®šç”¨ï¼‰ |

```bash
# ä¾‹: è‡ªå¾‹ãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•ï¼ˆç¢ºèªãªã—ï¼‰
SEQ2PIPE_AUTO_YES=1 ./launch.sh

# ä¾‹: QIIME2 conda env ã‚’æ‰‹å‹•æŒ‡å®š
QIIME2_CONDA_BIN=/opt/conda/envs/qiime2/bin ./launch.sh
```

---

## ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«

| ãƒ¢ãƒ‡ãƒ« | RAM | ç‰¹å¾´ |
|---|---|---|
| `qwen2.5-coder:7b` | 8 GB ä»¥ä¸Š | ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã«æœ€é©ï¼ˆæ¨å¥¨ï¼‰ |
| `qwen2.5-coder:3b` | 4 GB ä»¥ä¸Š | è»½é‡ãƒ»é«˜é€Ÿ |
| `llama3.2:3b` | 4 GB ä»¥ä¸Š | æ±ç”¨ãƒ»ä¼šè©±èƒ½åŠ›é«˜ã‚ |
| `qwen3:8b` | 16 GB ä»¥ä¸Š | æœ€é«˜å“è³ªãƒ»æ¨è«–èƒ½åŠ›ã‚‚é«˜ã„ |

### å°å‹ãƒ¢ãƒ‡ãƒ«ã¸ã®å¯¾å¿œï¼ˆãƒ­ãƒã‚¹ãƒˆãƒã‚¹æ©Ÿèƒ½ï¼‰

7B ä»¥ä¸‹ã®å°å‹ãƒ¢ãƒ‡ãƒ«ã§ã¯ Ollama ã® tool_calls ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«éå¯¾å¿œã®ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
seq2pipe ã¯ä»¥ä¸‹ã®å¤šå±¤ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿæ§‹ã§ã“ã‚Œã‚’è‡ªå‹•çš„ã«è£œã„ã¾ã™:

1. **`_parse_text_tool_calls`**: ãƒ†ã‚­ã‚¹ãƒˆæœ¬æ–‡ã«åŸ‹ã‚è¾¼ã¾ã‚ŒãŸ JSON ã‚’ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã¨ã—ã¦è§£æï¼ˆ5 ãƒ‘ã‚¿ãƒ¼ãƒ³å¯¾å¿œï¼‰
2. **Auto-inject `run_python`**: `write_file` ã§ .py ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ã„ãŸç›´å¾Œã€ãƒ¢ãƒ‡ãƒ«ãŒ `run_python` ã‚’å‘¼ã¶ã®ã‚’å¾…ãŸãšã«è‡ªå‹•å®Ÿè¡Œ
3. **ã‚¹ãƒ†ãƒƒãƒ— 6 ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ãƒ«ãƒ¼ãƒ—ãŒ 5 ã‚¹ãƒ†ãƒƒãƒ—é€²ã¾ãªã„å ´åˆã¯è‡ªå‹•çš„ã« 1 ã‚·ãƒ§ãƒƒãƒˆç”Ÿæˆï¼ˆ`run_code_agent`ï¼‰ã«åˆ‡ã‚Šæ›¿ãˆ
4. **ç¹°ã‚Šè¿”ã—æ¤œå‡º**: åŒã˜ 50 æ–‡å­—ãƒãƒ£ãƒ³ã‚¯ãŒ 4 å›é€£ç¶šã—ãŸã‚‰ç”Ÿæˆã‚’æ‰“ã¡åˆ‡ã‚Šï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—å›é¿ï¼‰

åˆ¥ã®ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ã†ã«ã¯:

```bash
QIIME2_AI_MODEL=qwen2.5-coder:3b ./launch.sh
```

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
ã‚ãªãŸ
  |
  v
[ launch.sh / cli.py ]
        |
        v
[ pipeline_runner.py ]  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  [ qiime2_agent.py ]
  QIIME2 ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œ                            QIIME2 ã‚³ãƒãƒ³ãƒ‰ç”Ÿæˆ
  stdout â†’ _Tee ã§ãƒ­ã‚°åé›†                          (11 ãƒ„ãƒ¼ãƒ«ã€STEP 0ã€œ8)
        |
        v
[ analysis.py / run_comprehensive_analysis() ]     â† STEP 2ï¼ˆæ±ºå®šè«–çš„ï¼‰
  LLM ä¸è¦ãƒ»15 ç¨®é¡ã® PNG å›³ã‚’ç¢ºå®Ÿã«ç”Ÿæˆ
  â”œâ”€â”€ fig01-fig12: åŸºæœ¬è§£æï¼ˆDADA2çµ±è¨ˆãƒ»Î±/Î²å¤šæ§˜æ€§ãƒ»ASVãƒ»ç›¸é–¢ï¼‰
  â””â”€â”€ fig13-fig15: åˆ†é¡çµ„æˆï¼ˆåˆ†é¡å™¨ã‚ã‚Šæ™‚ã®ã¿ï¼‰
        |
        v
[ code_agent.py / run_coding_agent() ]             â† ãƒ¢ãƒ¼ãƒ‰ 1 ã§ä½¿ç”¨
  LLM ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆvibe-local æ–¹å¼ï¼‰
  â”œâ”€â”€ list_files / read_file / write_file / run_python / install_package
  â”œâ”€â”€ _ensure_required_imports()  plt/pd ã®è‡ªå‹•è£œå®Œ
  â”œâ”€â”€ _convert_new_figs()         PDF/SVG â†’ PNG è‡ªå‹•å¤‰æ›ï¼ˆsipsï¼‰
  â”œâ”€â”€ NEVER GIVE UP: exit code â‰  0 â†’ write_file ä¿®æ­£ â†’ run_python å†å®Ÿè¡Œ
  â”œâ”€â”€ run_refinement_loop()       è§£æå¾Œã®æŒ¯ã‚Šè¿”ã‚Šãƒ»ä¿®æ­£ãƒ¢ãƒ¼ãƒ‰
  â””â”€â”€ å®Ÿè¡ŒæˆåŠŸ + å›³ç”Ÿæˆç¢ºèª â†’ CodeExecutionResult è¿”å´
        |
        v
[ report_generator.py ]
  â”œâ”€â”€ generate_html_report()  HTML ãƒ¬ãƒãƒ¼ãƒˆï¼ˆbase64 å›³åŸ‹ã‚è¾¼ã¿ï¼‰
  â””â”€â”€ generate_latex_report() LaTeX â†’ PDF ãƒ¬ãƒãƒ¼ãƒˆï¼ˆlualatex / xelatexï¼‰
        |
        v
  Ollama (localhost:11434)  â† ãƒ­ãƒ¼ã‚«ãƒ« LLM
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

<details>
<summary>Ollama ã«æ¥ç¶šã§ããªã„</summary>

```bash
ollama serve
```

</details>

<details>
<summary>QIIME2 conda ç’°å¢ƒãŒè‡ªå‹•æ¤œå‡ºã•ã‚Œãªã„</summary>

```bash
QIIME2_CONDA_BIN=/opt/conda/envs/qiime2/bin ./launch.sh
```

è‡ªå‹•æ¤œå‡ºã•ã‚Œã‚‹å€™è£œ: `~/miniforge3/envs/qiime2*/bin`, `~/miniconda3/envs/qiime2*/bin`, `~/anaconda3/envs/qiime2*/bin`

</details>

<details>
<summary>Docker ãŒè¦‹ã¤ã‹ã‚‰ãªã„ / èµ·å‹•ã—ã¦ã„ãªã„</summary>

QIIME2 conda ç’°å¢ƒãŒæ¤œå‡ºã•ã‚Œã¦ã„ã‚‹å ´åˆã€Docker ã¯ä¸è¦ã§ã™ã€‚

- macOS / Windows: Docker Desktop ã‚’èµ·å‹•ã—ã¦ãã ã•ã„
- Linux: `sudo systemctl start docker`

</details>

<details>
<summary>Python è§£æãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒè¶³ã‚Šãªã„</summary>

```bash
pip install numpy pandas matplotlib seaborn scipy scikit-learn biom-format networkx statsmodels
```

</details>

<details>
<summary>PDF ãƒ¬ãƒãƒ¼ãƒˆã® LaTeX ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã«å¤±æ•—ã™ã‚‹</summary>

`lualatex` ã¾ãŸã¯ `xelatex` ãŒå¿…è¦ã§ã™ï¼ˆMacTeX ã«å«ã¾ã‚Œã¦ã„ã¾ã™ï¼‰ã€‚

```bash
# macOSï¼ˆæ¨å¥¨ãƒ»ç´„ 100 MB ã® minimal ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼‰
brew install --cask mactex-no-gui

# ã¾ãŸã¯ MacTeX ãƒ•ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆç´„ 4 GBï¼‰
# https://tug.org/mactex/

# Linuxï¼ˆTeX Liveï¼‰
sudo apt install texlive-luatex texlive-xetex texlive-lang-japanese
```

LaTeX ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„å ´åˆã€`report.tex` ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ä¿å­˜ã•ã‚Œã¾ã™ã€‚
ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§æ‰‹å‹•ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã§ãã¾ã™:
```bash
lualatex report.tex   # æ—¥æœ¬èªå¯¾å¿œï¼ˆæ¨å¥¨ï¼‰
xelatex  report.tex   # ä»£æ›¿ã‚ªãƒ—ã‚·ãƒ§ãƒ³
```

</details>

<details>
<summary>å›³ãŒ PDF/SVG ã§å‡ºåŠ›ã•ã‚Œã‚‹ï¼ˆmacOS ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§é–‹ã‘ãªã„ï¼‰</summary>

seq2pipe ã¯ç”Ÿæˆã•ã‚ŒãŸ PDF/SVG ã‚’ macOS å†…è”µã® `sips` ã§è‡ªå‹•çš„ã« PNG ã¸å¤‰æ›ã—ã¾ã™ã€‚
æ—¢å­˜ã® PDF ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹å ´åˆã¯ä»¥ä¸‹ã§ä¸€æ‹¬å¤‰æ›ã§ãã¾ã™:

```bash
for f in ~/seq2pipe_results/*/figures/*.pdf; do
  sips -s format png "$f" --out "${f%.pdf}.png" && rm "$f"
done
```

</details>

<details>
<summary>ãƒ¢ãƒ‡ãƒ«ãŒé‡ã„ / å¿œç­”ãŒé…ã„</summary>

```bash
QIIME2_AI_MODEL=qwen2.5-coder:3b ./launch.sh
```

</details>

---

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
seq2pipe/
â”œâ”€â”€ cli.py              # ã‚¿ãƒ¼ãƒŸãƒŠãƒ« ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼ˆè™¹è‰²ãƒãƒŠãƒ¼ãƒ»ãƒ¢ãƒ¼ãƒ‰é¸æŠï¼‰
â”œâ”€â”€ qiime2_agent.py     # QIIME2 ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ç”Ÿæˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆ11 ãƒ„ãƒ¼ãƒ«ï¼‰
â”œâ”€â”€ pipeline_runner.py  # QIIME2 å®Ÿè¡Œãƒ©ãƒƒãƒ‘ãƒ¼ + çµæœã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆ_Tee ãƒ­ã‚°åé›†ï¼‰
â”œâ”€â”€ analysis.py         # æ±ºå®šè«–çš„åŒ…æ‹¬è§£æãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆ15 å›³ã€LLM ä¸è¦ï¼‰
â”œâ”€â”€ code_agent.py       # LLM ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆvibe-local æ–¹å¼ï¼‰
â”‚                       #   â””â”€â”€ run_refinement_loop()  æŒ¯ã‚Šè¿”ã‚Šãƒ»ä¿®æ­£ãƒ«ãƒ¼ãƒ—
â”œâ”€â”€ report_generator.py # HTML / LaTeX+PDF ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
â”œâ”€â”€ chat_agent.py       # è‡ªå¾‹è§£æã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ï¼ˆãƒ¬ã‚¬ã‚·ãƒ¼ï¼‰
â”œâ”€â”€ Figure/             # ãƒ‡ãƒ¢å‡ºåŠ›å›³ï¼ˆå®Ÿãƒ‡ãƒ¼ã‚¿è§£æçµæœ 15 å›³ï¼‰
â”‚   â”œâ”€â”€ fig01_dada2_stats.png
â”‚   â”œâ”€â”€ fig02_sequencing_depth.png
â”‚   â”œâ”€â”€ fig03_alpha_diversity.png
â”‚   â”œâ”€â”€ ...
â”‚   â”œâ”€â”€ fig14_phylum_composition.png
â”‚   â””â”€â”€ fig15_genus_heatmap.png
â”œâ”€â”€ Paper/              # æŠ€è¡“ãƒ¬ãƒãƒ¼ãƒˆï¼ˆTeX / PDFï¼‰
â”‚   â”œâ”€â”€ seq2pipe_ja.tex / seq2pipe_ja.pdf
â”‚   â””â”€â”€ seq2pipe_en.tex / seq2pipe_en.pdf
â”œâ”€â”€ launch.sh           # macOS / Linux èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ setup.sh            # macOS / Linux ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
â”œâ”€â”€ LICENSE             # MIT License
â””â”€â”€ README.md           # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

---

## Contributors

| | Name | Role |
|---|---|---|
| [@Rhizobium-gits](https://github.com/Rhizobium-gits) | Rhizobium-gits | Author |
| [@claude-bot](https://github.com/claude-bot) | Claude (Anthropic) | Co-author â€” design & implementation |

---

## å‚è€ƒãƒªãƒ³ã‚¯

- [QIIME2 å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.qiime2.org/)
- [QIIME2 Viewï¼ˆã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–å¯è¦–åŒ–ï¼‰](https://view.qiime2.org)
- [QIIME2 Forum](https://forum.qiime2.org/)
- [SILVA ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹](https://www.arb-silva.de/)
- [Ollama å…¬å¼ã‚µã‚¤ãƒˆ](https://ollama.com/)
- [MacTeXï¼ˆLaTeX for macOSï¼‰](https://tug.org/mactex/)

---

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

- ã“ã®ãƒ„ãƒ¼ãƒ«: MIT License
- SILVA 138 ãƒ‡ãƒ¼ã‚¿: [CC BY 4.0](https://creativecommons.org/licenses/by/4.0/)
- QIIME2: BSD License

---
---

<a name="english"></a>

# English

```
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â•šâ•â•â•â•â–ˆâ–ˆâ•—
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•”â•â•
 â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â–„â–„ â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â–€â–€â•â• â•šâ•â•â•â•â•â•
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â•
 â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â•šâ•â•     â•šâ•â•â•šâ•â•     â•šâ•â•â•â•â•â•â•
      sequence -> pipeline
```

> **Automate QIIME2 microbiome analysis with a local LLM â€” offline, no API key, open source**

[æ—¥æœ¬èª](#æ—¥æœ¬èª--english)

---

## What is this?

**seq2pipe** is a local AI agent that runs entirely on your own machine.
Give it your raw FASTQ data, and it automatically handles **pipeline design, execution, Python analysis, figure refinement, and report generation**.

- **Select Japanese or English at startup** â€” all AI responses and reports follow your choice
- Automatically checks for required Python packages (numpy / pandas / etc.) at startup
- Inspects your data structure automatically (FASTQ / metadata / existing QZA)
- Builds the right QIIME2 commands from scratch for your dataset
- Writes ready-to-run `.sh` / `.ps1` scripts
- **Two operation modes**: Chat (specify analysis in natural language) and Autonomous agent (AI designs and runs all analyses)
- **3-step automated analysis pipeline (`--auto` mode)**:
  - **STEP 1**: QIIME2 pipeline (DADA2 denoising, phylogeny, diversity, taxonomy)
  - **STEP 2**: Deterministic comprehensive analysis (`analysis.py`) â€” **15 publication-quality PNG figures generated reliably without LLM dependency**
  - **STEP 3**: Automatic HTML report generation
- **Tool-calling code generation agent (vibe-local style)**: LLM first calls `read_file` to understand column names and data format before writing code â€” far fewer format errors; if an error occurs, `NEVER GIVE UP` â€” it rewrites and retries until `EXIT CODE: 0`
- **Post-analysis refinement mode**: After analysis completes, instruct the LLM in natural language to refine figures ("change colors", "move legend outside") â€” code is automatically rewritten and re-executed
- Runs **Python downstream analysis** (pandas / scipy / scikit-learn / matplotlib / seaborn) on QIIME2 outputs
- **Auto-saves all figures as PNG** â€” PDF/SVG outputs are automatically converted via macOS built-in `sips`
- **Diversity analysis without metadata**: Alpha and beta diversity metrics computed automatically even without a metadata file
- **`--classifier` option**: Auto-discovery or explicit specification of SILVA 138 classifier for taxonomic analysis
- After analysis, HTML report is auto-generated in `--auto` mode; type **"report"** for HTML / **"PDF"** for LaTeX/PDF in chat mode

Everything runs **on your machine**. No cloud, no paid API, no internet required during analysis.

---

## Demo Output â€” Real Analysis Results

Actual output from seq2pipe on 10 human stool samples (TEST01-TEST10, freeze-dried, Illumina MiSeq paired-end V3-V4).
All figures were deterministically generated by `analysis.py` (STEP 2) as PNG.

### DADA2 Denoising Statistics

![DADA2 Stats](Figure/fig01_dada2_stats.png)

### Alpha Diversity â€” Shannon / Faith PD / Observed ASVs

![Alpha Diversity](Figure/fig03_alpha_diversity.png)

### Shannon Diversity (Per-Sample Strip Plot)

![Shannon Per Sample](Figure/fig04_shannon_per_sample.png)

### Beta Diversity â€” Bray-Curtis PCoA

![Bray-Curtis PCoA](Figure/fig05_pcoa_braycurtis.png)

### Beta Diversity â€” Unweighted UniFrac PCoA

![UniFrac PCoA](Figure/fig07_pcoa_unweighted_unifrac.png)

### Beta Diversity â€” Distance Heatmaps (4 Metrics)

![Beta Heatmaps](Figure/fig09_beta_distance_heatmaps.png)

### Taxonomic Composition â€” Genus-Level Stacked Bar

![Genus Composition](Figure/fig13_genus_composition.png)

### Taxonomic Composition â€” Genus-Level Heatmap

![Genus Heatmap](Figure/fig15_genus_heatmap.png)

> All 15 figures above are auto-generated in `--auto` mode and compiled into an HTML report.

---

## Requirements

| | macOS | Linux | Windows |
|---|---|---|---|
| Python | 3.9+ | 3.9+ | 3.9+ |
| Ollama | auto via `setup.sh` | auto via `setup.sh` | auto via `setup.bat` |
| QIIME2 | conda env (recommended) or Docker | conda env or Docker Engine | Docker Desktop |
| Docker | Optional (not needed if QIIME2 conda env exists) | Optional | Docker Desktop |
| Python analysis packages | included in QIIME2 conda env | included in QIIME2 conda env | manual pip |
| RAM | 8 GB+ recommended | 8 GB+ recommended | 8 GB+ recommended |
| Disk | ~10 GB (LLM + QIIME2) | ~10 GB | ~10 GB |

**Python analysis packages** (auto-installed by `setup.sh`):
`numpy`, `pandas`, `matplotlib`, `seaborn`, `scipy`, `scikit-learn`, `biom-format`, `networkx`, `statsmodels`

---

## Install (3 steps)

### macOS

```bash
git clone https://github.com/Rhizobium-gits/seq2pipe.git
cd seq2pipe
chmod +x setup.sh launch.sh
./setup.sh      # first time only
./launch.sh     # start
```

### Linux (Ubuntu / Debian / Fedora / Arch etc.)

```bash
git clone https://github.com/Rhizobium-gits/seq2pipe.git
cd seq2pipe
chmod +x setup.sh launch.sh
./setup.sh      # first time only (auto-installs Docker Engine)
./launch.sh     # start
```

> On Linux, you may need to run `newgrp docker` or log out and back in after `setup.sh` completes.

### Windows

```
1. git clone https://github.com/Rhizobium-gits/seq2pipe.git
2. Open the seq2pipe folder
3. Double-click setup.bat (first time only)
4. Double-click launch.bat to start
```

Using PowerShell:

```powershell
Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy RemoteSigned
.\setup.ps1   # first time only
.\launch.ps1  # start
```

Install Python packages manually on Windows:

```powershell
pip install numpy pandas matplotlib seaborn scipy scikit-learn biom-format networkx statsmodels
```

---

## Launch

```bash
./launch.sh     # macOS / Linux
.\launch.bat    # Windows
```

After launching, select your language (Japanese / English) and an interactive terminal session begins.

---

## Usage

### Mode 1 â€” Natural language analysis + refinement loop

```
$ ./launch.sh --fastq-dir ~/input

Enter request: Shannon diversity violin plot by group

[list_files]  scan exported directory
[read_file]   alpha/shannon_vector.tsv (check column names)
[write_file]  analysis.py
[run_python]  EXIT CODE: 0 â†’ figures/shannon_violin.png

âœ… Analysis complete!

  âœï¸  Refinement mode
  Refine generated figures with natural language instructions.
  Examples: "move legend outside the plot"
            "enlarge PCoA dots and show sample names"
            "use a colorblind-friendly palette"
  ğŸ“„ Reports:
      HTML: type "report"
      PDF:  type "PDF" or "latex"
  Exit: empty Enter / quit / done

âœï¸  Refine> enlarge dots and add sample labels to PCoA

[write_file] analysis.py (modified)
[run_python] EXIT CODE: 0 â†’ figures/fig10_beta_pcoa.png updated

âœï¸  Refine> PDF

ğŸ“ Generating PDF report (LaTeX)...
ğŸ“ LaTeX engine detected: lualatex
âœ… PDF report generated!
ğŸ“„ File: /path/to/results/report.pdf
```

### Mode 2 â€” Fully autonomous (--auto)

```bash
cd ~/seq2pipe
./launch.sh --fastq-dir ~/input --auto
```

Runs the full QIIME2 pipeline + deterministic analysis (15 figures) + HTML report automatically.

### Taxonomic analysis (`--classifier`)

Enable taxonomic analysis by providing a SILVA 138 Naive Bayes classifier:

```bash
# Auto-discovery (if classifier exists in the seq2pipe directory)
./launch.sh --fastq-dir ~/input --auto

# Explicit path
./launch.sh --fastq-dir ~/input --auto --classifier ~/silva-138-99-nb-classifier.qza
```

When a classifier is detected, QIIME2 performs taxonomic classification, and
`analysis.py` generates genus/phylum composition figures (fig13-fig15).

### Output file structure

```
~/seq2pipe_results/<timestamp>/
â”œâ”€â”€ exported/                  â† QIIME2 exported data
â”‚   â”œâ”€â”€ feature-table.tsv
â”‚   â”œâ”€â”€ taxonomy/taxonomy.tsv
â”‚   â”œâ”€â”€ alpha/<metric>/alpha-diversity.tsv
â”‚   â”œâ”€â”€ beta/<matrix>/distance-matrix.tsv
â”‚   â””â”€â”€ denoising_stats/stats.tsv
â”œâ”€â”€ figures/                   â† all saved as PNG
â”‚   â”œâ”€â”€ fig01_dada2_stats.png
â”‚   â”œâ”€â”€ fig02_sequencing_depth.png
â”‚   â”œâ”€â”€ fig03_alpha_diversity.png
â”‚   â”œâ”€â”€ fig04_shannon_per_sample.png
â”‚   â”œâ”€â”€ fig05_pcoa_braycurtis.png
â”‚   â”œâ”€â”€ fig06_pcoa_jaccard.png
â”‚   â”œâ”€â”€ fig07_pcoa_unweighted_unifrac.png
â”‚   â”œâ”€â”€ fig08_pcoa_weighted_unifrac.png
â”‚   â”œâ”€â”€ fig09_beta_distance_heatmaps.png
â”‚   â”œâ”€â”€ fig10_top30_asv_heatmap.png
â”‚   â”œâ”€â”€ fig11_alpha_correlations.png
â”‚   â”œâ”€â”€ fig12_richness_vs_depth.png
â”‚   â”œâ”€â”€ fig13_genus_composition.png      â† with classifier
â”‚   â”œâ”€â”€ fig14_phylum_composition.png     â† with classifier
â”‚   â””â”€â”€ fig15_genus_heatmap.png          â† with classifier
â”œâ”€â”€ report.html                â† HTML report (auto-generated)
â”œâ”€â”€ report.tex                 â† LaTeX source (type "PDF")
â””â”€â”€ report.pdf                 â† PDF report (lualatex/xelatex compiled)
```

---

## Supported analyses

### QIIME2 core (STEP 1)
| Analysis | Command |
|---|---|
| Import & demultiplex | `qiime tools import` |
| DADA2 denoising | `qiime dada2 denoise-paired/single` |
| Taxonomic classification (SILVA 138) | `qiime feature-classifier classify-sklearn` |
| Composition bar chart | `qiime taxa barplot` |
| Alpha & beta diversity (with metadata) | `qiime diversity core-metrics-phylogenetic` |
| Alpha & beta diversity (without metadata) | `qiime diversity alpha` / `qiime diversity beta` (individual) |
| Differential abundance ANCOM-BC | `qiime composition ancombc` |

### Deterministic comprehensive analysis (STEP 2 â€” `analysis.py`, no LLM required)
| Figure | Analysis | Packages |
|---|---|---|
| fig01 | DADA2 denoising statistics | pandas, matplotlib |
| fig02 | Sequencing depth per sample | pandas, matplotlib |
| fig03 | Alpha diversity boxplots (Shannon / Faith PD / Observed ASVs) | pandas, seaborn |
| fig04 | Shannon diversity per sample (strip plot) | pandas, seaborn |
| fig05 | Bray-Curtis PCoA | pandas, sklearn (MDS) |
| fig06 | Jaccard PCoA | pandas, sklearn (MDS) |
| fig07 | Unweighted UniFrac PCoA | pandas, sklearn (MDS) |
| fig08 | Weighted UniFrac PCoA | pandas, sklearn (MDS) |
| fig09 | Beta diversity distance heatmaps (4 metrics, 2x2) | pandas, seaborn |
| fig10 | Top 30 ASV heatmap | pandas, seaborn |
| fig11 | Alpha diversity correlation plots | pandas, matplotlib |
| fig12 | ASV richness vs sequencing depth | pandas, matplotlib |
| fig13 | Genus-level stacked bar (with classifier) | pandas, matplotlib |
| fig14 | Phylum-level stacked bar (with classifier) | pandas, matplotlib |
| fig15 | Genus-level heatmap (with classifier) | pandas, seaborn |

### Python downstream (LLM code agent â€” Mode 1)
| Analysis | Packages |
|---|---|
| Alpha diversity 4-panel (Shannon / Faith PD / Evenness / Observed Features) | pandas, seaborn |
| Bray-Curtis PCoA (sklearn MDS) | pandas, sklearn |
| UniFrac PCoA (unweighted / weighted) | pandas, sklearn |
| NMDS (non-metric multidimensional scaling) | pandas, sklearn |
| CLR-transformed PCA | pandas, sklearn |
| Phylum/genus stacked bar (with taxonomy) | pandas, seaborn |
| Genus-level heatmap (with taxonomy) | pandas, seaborn |
| Sample correlation matrix | pandas, scipy, seaborn |
| HTML / LaTeX+PDF report auto-generation | report_generator.py (lualatex / xelatex) |

---

## Environment variables

| Variable | Default | Description |
|---|---|---|
| `QIIME2_AI_MODEL` | `qwen2.5-coder:7b` | Ollama model to use |
| `SEQ2PIPE_AUTO_YES` | `0` | Set to `1` to skip command confirmation (autonomous mode) |
| `SEQ2PIPE_MAX_STEPS` | `100` | Maximum agent loop steps |
| `SEQ2PIPE_PYTHON_TIMEOUT` | `600` | Timeout in seconds for Python execution |
| `QIIME2_CONDA_BIN` | auto-detected | Path to QIIME2 conda env bin directory (manual override) |

---

## Models

| Model | RAM | Description |
|---|---|---|
| `qwen2.5-coder:7b` | 8 GB+ | Best for code generation (recommended) |
| `qwen2.5-coder:3b` | 4 GB+ | Lightweight and fast |
| `llama3.2:3b` | 4 GB+ | General purpose, good conversation |
| `qwen3:8b` | 16 GB+ | Highest quality, strong reasoning |

---

## Architecture

```
You
  |
  v
[ launch.sh / cli.py ]
        |
        v
[ pipeline_runner.py ]  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  [ qiime2_agent.py ]
  QIIME2 pipeline execution                         QIIME2 command generation
  stdout captured by _Tee logger                    (11 tools, STEP 0-8)
        |
        v
[ analysis.py / run_comprehensive_analysis() ]     â† STEP 2 (deterministic)
  No LLM dependency â€” 15 PNG figures reliably generated
  â”œâ”€â”€ fig01-fig12: Core analysis (DADA2 stats, alpha/beta, ASV, correlation)
  â””â”€â”€ fig13-fig15: Taxonomy (when classifier is available)
        |
        v
[ code_agent.py / run_coding_agent() ]             â† Used in Mode 1
  LLM code generation agent (vibe-local style)
  â”œâ”€â”€ list_files / read_file / write_file / run_python / install_package
  â”œâ”€â”€ _convert_new_figs()    PDF/SVG â†’ PNG auto-conversion (sips)
  â”œâ”€â”€ NEVER GIVE UP: exit â‰  0 â†’ rewrite â†’ retry
  â””â”€â”€ run_refinement_loop()  post-analysis natural-language refinement
        |
        v
[ report_generator.py ]
  â”œâ”€â”€ generate_html_report()  base64-embedded HTML report
  â””â”€â”€ generate_latex_report() LaTeX â†’ PDF (lualatex / xelatex)
        |
        v
  Ollama (localhost:11434)  â† Local LLM
```

---

## Troubleshooting

<details>
<summary>Cannot connect to Ollama</summary>

```bash
ollama serve
```

</details>

<details>
<summary>QIIME2 conda env not detected automatically</summary>

```bash
QIIME2_CONDA_BIN=/opt/conda/envs/qiime2/bin ./launch.sh
```

</details>

<details>
<summary>Docker not found / not running</summary>

Docker is not required if a QIIME2 conda env is detected.

- macOS / Windows: Start Docker Desktop
- Linux: `sudo systemctl start docker`

</details>

<details>
<summary>Python analysis packages missing</summary>

```bash
pip install numpy pandas matplotlib seaborn scipy scikit-learn biom-format networkx statsmodels
```

</details>

<details>
<summary>LaTeX PDF compilation fails</summary>

Install MacTeX (includes lualatex and xelatex):

```bash
# macOS â€” minimal install (~100 MB)
brew install --cask mactex-no-gui

# Linux
sudo apt install texlive-luatex texlive-xetex texlive-lang-japanese

# Manual compile (if auto-compile fails)
lualatex report.tex   # preferred (Japanese support)
xelatex  report.tex   # alternative
```

If no LaTeX engine is found, `report.tex` is saved for manual compilation.

</details>

<details>
<summary>Figures saved as PDF/SVG (cannot open in macOS Preview)</summary>

seq2pipe automatically converts PDF/SVG to PNG using macOS built-in `sips`.
For existing PDF files, batch-convert with:

```bash
for f in ~/seq2pipe_results/*/figures/*.pdf; do
  sips -s format png "$f" --out "${f%.pdf}.png" && rm "$f"
done
```

</details>

<details>
<summary>Model is slow / responses take too long</summary>

```bash
QIIME2_AI_MODEL=qwen2.5-coder:3b ./launch.sh
```

</details>

---

## File structure

```
seq2pipe/
â”œâ”€â”€ cli.py              # Terminal entry point (rainbow banner / mode selection)
â”œâ”€â”€ qiime2_agent.py     # QIIME2 pipeline generation agent (11 tools)
â”œâ”€â”€ pipeline_runner.py  # QIIME2 execution wrapper + result export (_Tee logger)
â”œâ”€â”€ analysis.py         # Deterministic comprehensive analysis module (15 figures, no LLM)
â”œâ”€â”€ code_agent.py       # LLM code generation agent (vibe-local style)
â”‚                       #   â””â”€â”€ run_refinement_loop()  post-analysis refinement
â”œâ”€â”€ report_generator.py # HTML and LaTeX/PDF report generation
â”œâ”€â”€ chat_agent.py       # Autonomous analysis session (legacy)
â”œâ”€â”€ Figure/             # Demo output figures (real data analysis results, 15 figures)
â”‚   â”œâ”€â”€ fig01_dada2_stats.png
â”‚   â”œâ”€â”€ fig02_sequencing_depth.png
â”‚   â”œâ”€â”€ fig03_alpha_diversity.png
â”‚   â”œâ”€â”€ ...
â”‚   â”œâ”€â”€ fig14_phylum_composition.png
â”‚   â””â”€â”€ fig15_genus_heatmap.png
â”œâ”€â”€ Paper/              # Technical report (TeX / PDF)
â”‚   â”œâ”€â”€ seq2pipe_ja.tex / seq2pipe_ja.pdf
â”‚   â””â”€â”€ seq2pipe_en.tex / seq2pipe_en.pdf
â”œâ”€â”€ launch.sh           # macOS / Linux launcher
â”œâ”€â”€ setup.sh            # macOS / Linux setup
â”œâ”€â”€ LICENSE             # MIT License
â””â”€â”€ README.md           # This file
```

---

## Contributors

| | Name | Role |
|---|---|---|
| [@Rhizobium-gits](https://github.com/Rhizobium-gits) | Rhizobium-gits | Author |
| [@claude-bot](https://github.com/claude-bot) | Claude (Anthropic) | Co-author â€” design & implementation |

---

## References

- [QIIME2 Official Documentation](https://docs.qiime2.org/)
- [QIIME2 View (interactive visualization)](https://view.qiime2.org)
- [QIIME2 Forum](https://forum.qiime2.org/)
- [SILVA Database](https://www.arb-silva.de/)
- [Ollama](https://ollama.com/)
- [MacTeX (LaTeX for macOS)](https://tug.org/mactex/)

---

## License

- This tool: MIT License
- SILVA 138 data: [CC BY 4.0](https://creativecommons.org/licenses/by/4.0/)
- QIIME2: BSD License
